!function(e,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?exports.sandbox=s():e.sandbox=s()}(this,(function(){return(()=>{"use strict";var e={780:(e,s,t)=>{t.r(s);class a{constructor(){this.promise=new Promise(((e,s)=>{this.resolve=e,this.reject=s}))}}class n{listen(e,s){this.addListener(e);var t=()=>this.removeListener(e);return s&&s.onCancelled(t),{cancel:t}}filter(e){return new h(this,e)}map(e){return new d(this,e)}mapAsync(e){return new c(this,e)}compare(e){return new i(this,e)}when(e,s){var t,a=new Promise((e=>{t=e})),n=this.listen((function(){var s=[].slice.apply(arguments);e.apply(null,s)&&(n.cancel(),t(s))}),s);return a}next(e){return this.when((()=>!0),e)}debounce(e){return new p(this,e)}}class i extends n{constructor(e,s){super(),this.source=e,this.getInitialArgs=s}listen(e,s){var t=this.getInitialArgs();return this.source.listen((function(){var s=Array.prototype.slice.apply(arguments),a=e(t,s);return t=s,a}),s)}}class r{constructor(e){this.source=e,this.listenersAndCancellationTokensAndSubscriptions=[]}cancelSubscriptionForListener(e){var s=this.removeListener(e);s&&s.subscription.cancel()}removeListener(e){var s=this.listenersAndCancellationTokensAndSubscriptions.findIndex((s=>s.listener===e));if(-1===s)return null;var[t]=this.listenersAndCancellationTokensAndSubscriptions.splice(s,1);return t}listen(e,s){var t=this.source.listen(e,s),a={listener:e,cancellationToken:s,subscription:t};return s&&s.onCancelled((()=>this.removeListener(e))),this.listenersAndCancellationTokensAndSubscriptions.push(a),{cancel:()=>this.cancelSubscriptionForListener(e)}}cancel(){for(let e of this.listenersAndCancellationTokensAndSubscriptions)e.subscription.cancel()}}class o extends n{constructor(e){super(),this.sourcesAndListeners=e.map((e=>new r(e))),this.listenersAndCancellationTokens=[]}removeListener(e){var s=this.listenersAndCancellationTokens.findIndex((s=>s.listener===e));-1!==s&&this.listenersAndCancellationTokens.splice(s,1)}addSource(e){var s=new r(e);for(let{listener:e,cancellationToken:t}of this.listenersAndCancellationTokens)s.listen(e,t);this.sourcesAndListeners.push(s)}removeSource(e){var s=this.sourcesAndListeners.findIndex((s=>s.source===e));if(-1!==s){var[t]=this.sourcesAndListeners.splice(s,1);t.cancel()}}listen(e,s){for(let t of this.sourcesAndListeners)t.listen(e,s);return s&&s.onCancelled((()=>this.removeListener(e))),this.listenersAndCancellationTokens.push({listener:e,cancellationToken:s}),{cancel:()=>{for(let s of this.sourcesAndListeners)s.cancelSubscriptionForListener(e);this.removeListener(e)}}}}class c extends n{constructor(e,s){super(),this.eventSource=e,this.mapAsync=s}listen(e,s){var t=this;return this.eventSource.listen((function(){var s=Array.prototype.slice.apply(arguments);t.mapAsync(...s).then((s=>{s?e(...s):e()}))}),s)}}class g extends n{constructor(e){super(),this.eventSource=e}listen(e,s){var t=this;return this.eventSource.listen((function(){var s=Array.prototype.slice.apply(arguments),a=t.map(...s);return e(...a)}),s)}}class u extends n{constructor(e){super(),this.eventSource=e}listen(e,s){var t=this;return this.eventSource.listen((function(){var s=Array.prototype.slice.apply(arguments);if(t.filter(...s))return e(...s)}),s)}}class h extends u{constructor(e,s){super(e),this.filter=s}}class d extends g{constructor(e,s){super(e),this.map=s}}class l extends n{constructor(){super(),this.listeners=[]}addListener(e){this.listeners.push(e)}removeListener(e){var s=this.listeners.indexOf(e);s>-1&&this.listeners.splice(s,1)}dispatch(){var e=Array.prototype.slice.apply(arguments);for(let s of this.listeners.slice())s(...e)}}class p extends l{constructor(e,s){super(),this.originalEventSource=e,this.interval=s,this.currentTimeout=void 0,this.subscription=void 0,this.latestArgs=void 0,this.waiting=!1}addListener(e){super.addListener(e),this.start()}removeListener(e){super.removeListener(e),0===this.listeners.length&&this.stop()}renewTimeout(){void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((()=>{this.dispatch(...this.latestArgs),this.waiting=!1,this.currentTimeout=void 0}),this.interval),this.waiting=!0}start(){this.subscription=this.originalEventSource.listen(((...e)=>{this.latestArgs=e,this.renewTimeout()}))}stop(){void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.subscription&&this.subscription.cancel()}}class m{constructor(e){this.type=e}filterMessage(e){return e.type===this.type}unpackMessage(e){return e.message}packMessage(e){return{type:this.type,message:e}}toString(){return this.type}}class v{onMessage(e,s){return{cancel(){}}}nextMessage(e){var s=new a,t=this.onMessage((e=>{t.cancel(),s.resolve(e)}),e);return s.promise}ofType(e){return new b(this,e)}}class w{async sendMessageAsync(e){}sendMessage(e){}ofType(e){return new M(this,e)}}class b extends v{constructor(e,s){super(),this.messagesSource=e,this.messageType=s}onMessage(e,s){return this.messagesSource.onMessage(((s,t)=>{if(this.messageType.filterMessage(s))return e(this.messageType.unpackMessage(s),t)}),s)}}class M extends w{constructor(e,s){super(),this.messagesTarget=e,this.messageType=s}sendMessage(e){this.messagesTarget.sendMessage(this.messageType.packMessage(e))}sendMessageAsync(e){return this.messagesTarget.sendMessageAsync(this.messageType.packMessage(e))}}class T extends v{constructor(e,s){super(),this.sourceWindow=e,this.messagesEventSource=s.filter((s=>s.source===e&&s.data&&"message"===s.data.type)).map((e=>[e.data.message,s=>this.sendResponseToMessage(e.data.messageId,s)]))}sendResponseToMessage(e,s){this.sourceWindow.postMessage({type:"response",messageId:e,response:s},"*")}onMessage(e,s){return this.messagesEventSource.listen(e,s)}}class y{constructor(e){this.messageId=e,this.promise=new Promise((e=>{this.resolve=e}))}}class f extends w{constructor(e,s){super(),this.latestMessageId=0,this.messageResponsePromises=[],this.targetWindow=e,s.filter((s=>s.source===e&&s.data&&"response"===s.data.type)).listen((e=>this.resolveResponsePromise(e.data.messageId,e.data.response)))}resolveResponsePromise(e,s){const t=this.messageResponsePromises.findIndex((s=>s.messageId===e));if(-1===t)return;const[a]=this.messageResponsePromises.splice(t,1);a.resolve(s)}async sendMessageAsync(e){const s=++this.latestMessageId,t=new y(s);return this.messageResponsePromises.push(t),this.targetWindow.postMessage({type:"message",messageId:s,message:e},"*"),t.promise}sendMessage(e){const s=++this.latestMessageId;this.targetWindow.postMessage({type:"message",messageId:s,message:e},"*")}}class I{constructor(e,s){this.source=e,this.target=s}}class C extends v{constructor(e,s){super(),this.source=s.ofType(e)}onMessage(e,s){return this.source.onMessage(e,s)}}class S extends w{constructor(e,s){super(),this.target=s.ofType(e)}sendMessageAsync(e){return this.target.sendMessageAsync(e)}sendMessage(e){this.target.sendMessage(e)}}class A{constructor(e,s){this.messagesSource=e,this.messagesTarget=s}createChannel(e){const s=new C(e,this.messagesSource),t=new S(e,this.messagesTarget);return new I(s,t)}static create(e,s){const t=new T(e,s),a=new f(e,s);return new A(t,a)}}class x{constructor(e){this.type=e}filterMessage(e){return"messageBusMessage"===e.type&&e.subType===this.type}unpackMessage(e){return e.message}packMessage(e){return{type:"messageBusMessage",subType:this.type,message:e}}toString(){return`messageBus:${this.type}`}}class P extends v{constructor(e,s,t){super(),this.type=e,this.iframeChannelSource=s,this.channelSubscriptionMessageTarget=t}onMessage(e,s){return this.channelSubscriptionMessageTarget.sendMessage({messageType:this.type,sendsResponse:2===e.length}),this.iframeChannelSource.onMessage(e,s)}}class R extends w{constructor(e,s,t){super(),this.type=e,this.targetInitializationMessageTarget=t,this.iframeChannelTarget=s,this.targetInitialized=!1}async ensureInitialized(e){this.targetInitialized||(await this.targetInitializationMessageTarget.sendMessageAsync({messageType:this.type,expectsResponse:e}),this.targetInitialized=!0)}async sendMessageAsync(e){return await this.ensureInitialized(!0),await this.iframeChannelTarget.sendMessageAsync(e)}sendMessage(e){this.ensureInitialized(!1).then((()=>{this.iframeChannelTarget.sendMessage(e)}))}}class L{constructor(e,s){this.source=e,this.target=s}}class N{constructor(e,s,t){this.iframeMessageBus=e,this.targetInitializationMessageTarget=s,this.channelSubscriptionMessageTarget=t}createChannel(e){const s=this.iframeMessageBus.createChannel(new x(e)),t=new P(e,s.source,this.channelSubscriptionMessageTarget),a=new R(e,s.target,this.targetInitializationMessageTarget);return new L(t,a)}}function E(e,s,t){t?e.source.onMessage((async(e,t)=>{t(await s.target.sendMessageAsync(e))})):e.source.onMessage((e=>{s.target.sendMessage(e)}))}class F{static initializeForParent(e,s,t,a){t.onMessage((({messageType:s,sendsResponse:t})=>{const n=e.createChannel(new x(s));E(a.createChannel(s),n,t)})),s.onMessage((({messageType:s,expectsResponse:t},n)=>{E(e.createChannel(new x(s)),a.createChannel(s),t),n()}))}static createForIframe(e,s,t){return new N(e,s,t)}}class W{constructor(e,s,t,a,n,i){this.id=e,this.historyId=s,this.url=t,this.tabId=a,this.frameId=n,this.focusNavigationMessageTarget=i}focus(){this.focusNavigationMessageTarget.sendMessage(this.id)}}class q{constructor(e,s,t,a,n,i,r){this.navigationDisappearedMessageSource=e,this.navigationExistsMessageTarget=s,this.navigationPropsRequestTarget=t,this.focusNavigationMessageTarget=a,this.popupTabIdMessageTarget=n,this.navigationsForPopupMessageTarget=i,this.openTabMessageTarget=r}openTab(e){this.openTabMessageTarget.sendMessage(e)}getNavigationsForPopup(){return this.navigationsForPopupMessageTarget.sendMessageAsync()}getPopupTabId(){return this.popupTabIdMessageTarget.sendMessageAsync()}navigationExists(e){return this.navigationExistsMessageTarget.sendMessageAsync(e)}onDisappeared(e,s){return this.navigationDisappearedMessageSource.onMessage(e,s)}whenDisappeared(e){return new Promise((s=>{const t=this.navigationDisappearedMessageSource.onMessage((async()=>{await this.navigationExists(e)||(t.cancel(),s())}))}))}async getNavigation(e){if(!await this.navigationExists(e))return null;const{id:s,historyId:t,url:a,tabId:n,frameId:i}=await this.navigationPropsRequestTarget.sendMessageAsync(e);return new W(s,t,a,n,i,this.focusNavigationMessageTarget)}}class z{constructor(){this.watching=!1,this.inputHasHappened=!1,this.whenInputHappenedPromise=void 0}watch(){this.watching||(this.whenInputHappenedPromise=new Promise((e=>{const s=()=>{this.inputHasHappened=!0,e(),removeEventListener("input",s)};addEventListener("input",s)})),this.watching=!0)}async whenInputHasHappened(){this.inputHasHappened||(this.watch(),await this.whenInputHappenedPromise)}}class k{constructor(e,s,t,a,n,i){this.documentTitleMessageTarget=e,this.historyStateMessageTarget=s,this.closeWindowMessageTarget=t,this.unsavedChangesWarningEnabledMessageTarget=a,this.downloadJsonMessageTarget=n,this.copyToClipboardMessageTarget=i,this.unsavedChangesWarningEnabled=!1,this.windowInputWatcher=new z,this.windowInputWatcher.watch()}getLocation(){return window.location.href}close(){this.closeWindowMessageTarget.sendMessage({})}downloadJson(e,s){this.downloadJsonMessageTarget.sendMessage({object:e,fileName:s})}copyToClipboard(e){return this.copyToClipboardMessageTarget.sendMessageAsync({text:e})}setUnsavedChangedWarningEnabled(e){e!==this.unsavedChangesWarningEnabled&&(this.unsavedChangesWarningEnabled=e,e?this.windowInputWatcher.whenInputHasHappened().then((()=>{this.unsavedChangesWarningEnabled&&this.unsavedChangesWarningEnabledMessageTarget.sendMessage({enabled:!0})})):this.unsavedChangesWarningEnabledMessageTarget.sendMessage({enabled:!1}))}async pushHistoryState(e){history.pushState("",{},e),await this.historyStateMessageTarget.sendMessageAsync(e)}setTitle(e){document.title=e,this.documentTitleMessageTarget.sendMessage(e)}}class B{constructor(e){this.inspectedWindowTabIdMessageTarget=e}getTabId(){return this.inspectedWindowTabIdMessageTarget.sendMessageAsync()}}class H{constructor(){const e=new l;this.firstInvocationAfterObserve=!0,this.observer=new ResizeObserver((()=>{this.firstInvocationAfterObserve?this.firstInvocationAfterObserve=!1:e.dispatch()})),this.debouncedResize=e.debounce(100)}start(){this.firstInvocationAfterObserve=!0,this.observer.observe(document.body)}stop(){this.observer.disconnect()}}class D{constructor(e){this.documentTitleChannel=e.createChannel(new m("documentTitle")),this.bodySizeChannel=e.createChannel(new m("bodySize")),this.messageBusChannelSubscriptionMessage=e.createChannel(new m("messageBusChannelSubscription")),this.messageBusIntializeTargetRequest=e.createChannel(new m("initializeTargetRequest")),this.navigationDisappearedMessage=e.createChannel(new m("navigationDisappeared")),this.navigationExistsRequest=e.createChannel(new m("navigationExists")),this.getNavigationPropertiesRequest=e.createChannel(new m("navigationPropertiesRequest")),this.pushHistoryStateMessage=e.createChannel(new m("pushHistoryState")),this.focusNavigationMessage=e.createChannel(new m("focusNavigation")),this.popupTabIdMessage=e.createChannel(new m("getPopupTabId")),this.getNavigationsForPopupMessage=e.createChannel(new m("getNavigationsForPopup")),this.openTabMessage=e.createChannel(new m("openTab")),this.inspectedWindowTabIdMessage=e.createChannel(new m("inspectedWindowTabId")),this.closeWindowMessage=e.createChannel(new m("closeWindow")),this.unsavedChangesWarningEnabledMessage=e.createChannel(new m("unsavedChangesWarningEnabled")),this.copyToClipboardMessage=e.createChannel(new m("copyToClipboard")),this.downloadJsonMessage=e.createChannel(new m("downloadJson")),this.windowMessageBus=e}}class O extends D{constructor(e,s){super(e),F.initializeForParent(this.windowMessageBus,this.messageBusIntializeTargetRequest.source,this.messageBusChannelSubscriptionMessage.source,s)}onDocumentTitleChanged(e,s){return this.documentTitleChannel.source.onMessage(e,s)}onWindowCloseRequested(e,s){return this.closeWindowMessage.source.onMessage(e,s)}onUnsavedChangesWarningEnabled(e,s){return this.unsavedChangesWarningEnabledMessage.source.onMessage(e,s)}onCopyToClipboardMessage(e,s){return this.copyToClipboardMessage.source.onMessage(e,s)}setNavigationDisappeared(e){e.listen((()=>{this.navigationDisappearedMessage.target.sendMessage()}))}onRequestToDownloadJson(e,s){return this.downloadJsonMessage.source.onMessage(e,s)}onRequestNavigationExists(e,s){return this.navigationExistsRequest.source.onMessage(e,s)}onRequestNavigationProperties(e,s){return this.getNavigationPropertiesRequest.source.onMessage(e,s)}onRequestToPushHistoryState(e,s){return this.pushHistoryStateMessage.source.onMessage(e,s)}onRequestToFocusNavigation(e,s){return this.focusNavigationMessage.source.onMessage(e,s)}onRequestNavigationsForPopup(e,s){return this.getNavigationsForPopupMessage.source.onMessage(e,s)}onRequestPopupTabId(e,s){return this.popupTabIdMessage.source.onMessage(e,s)}onBodySizeChange(e,s){return this.bodySizeChannel.source.onMessage(e,s)}onRequestToOpenTab(e,s){return this.openTabMessage.source.onMessage(e,s)}onRequestInspectedWindowTabId(e,s){return this.inspectedWindowTabIdMessage.source.onMessage(e,s)}}class U extends D{constructor(e){super(e),this.setDocumentTitle(document.title),async function(){document&&document.body||await new Promise((e=>{const s=()=>{document&&document.body&&(removeEventListener("load",s),e())};addEventListener("load",s)}))}().then((async()=>{const e=new H;for(;;)await this.setBodySize(),e.start(),await e.debouncedResize.next(),e.stop()}))}setDocumentTitle(e){this.documentTitleChannel.target.sendMessage(e)}setBodySize(){return this.bodySizeChannel.target.sendMessageAsync({width:document.body.scrollWidth,height:document.body.scrollHeight})}getMessageBus(){return F.createForIframe(this.windowMessageBus,this.messageBusIntializeTargetRequest.target,this.messageBusChannelSubscriptionMessage.target)}getNavigationInterface(){const e=this.navigationDisappearedMessage.source,s=this.navigationExistsRequest.target,t=this.getNavigationPropertiesRequest.target,a=this.focusNavigationMessage.target,n=this.popupTabIdMessage.target,i=this.getNavigationsForPopupMessage.target,r=this.openTabMessage.target;return new q(e,s,t,a,n,i,r)}getPageInterface(){const e=this.documentTitleChannel.target,s=this.pushHistoryStateMessage.target,t=this.closeWindowMessage.target,a=this.unsavedChangesWarningEnabledMessage.target,n=this.downloadJsonMessage.target,i=this.copyToClipboardMessage.target;return new k(e,s,t,a,n,i)}getInspectedWindow(){const e=this.inspectedWindowTabIdMessage.target;return new B(e)}}var j=new class extends n{addListener(e){chrome.tabs.onRemoved.addListener(e)}removeListener(e){chrome.tabs.onRemoved.removeListener(e)}},$=new class extends n{addListener(e){chrome.webNavigation.onCommitted.addListener(e)}removeListener(e){chrome.webNavigation.onCommitted.removeListener(e)}},J=new class extends n{addListener(e){chrome.webNavigation.onHistoryStateUpdated.addListener(e)}removeListener(e){chrome.webNavigation.onHistoryStateUpdated.removeListener(e)}},_=new class extends n{addListener(e){chrome.webNavigation.onReferenceFragmentUpdated.addListener(e)}removeListener(e){chrome.webNavigation.onReferenceFragmentUpdated.removeListener(e)}},V=new o([J,_]);function G(e,s,t){return`${e}:${s}:${t}`}function K(e,s){return`${e}:${s}`}class Q{constructor(e,s,t){this.id=G(e,s,t),this.historyId=K(e,s),this.url=t,this.tabId=e,this.frameId=s}focus(){chrome.tabs.update(this.tabId,{active:!0})}}class X extends w{constructor(e,s){super(),this.tabMessagesTargets=e,this.runtimeMessagesTarget=s,this.updated=new l}prune(e){this.tabMessagesTargets=this.tabMessagesTargets.filter((s=>-1!==e.indexOf(s.tabId)))}getTargets(){return[this.runtimeMessagesTarget].concat(this.tabMessagesTargets)}sendMessageAsync(e){return new Promise((s=>{var t=this.getTargets();for(let a of t)a.sendMessageAsync(e).then((e=>s(e)),(e=>{}))}))}sendMessage(e){for(var s of this.getTargets())s.sendMessage(e)}serialize(){return this.tabMessagesTargets.map((e=>e.tabId))}addTarget(e){this.tabMessagesTargets.some((s=>s.tabId===e.tabId))||(this.tabMessagesTargets.push(e),this.updated.dispatch())}static create(e,s,t){const a=e.map((e=>t.createTarget(e)));return new X(a,s)}}class Y{constructor(e,s,t,a){this.storage=e,this.tabCollection=s,this.runtimeMessagesTarget=t,this.tabMessagesTargetFactory=a,this.loaded=!1,this.subscriptions={}}async pruneSubscriptions(){this.ensureLoaded();const e=(await this.tabCollection.getAllTabs()).map((e=>e.id));for(let s of Object.getOwnPropertyNames(this.subscriptions)){const t=this.subscriptions[s];t&&t.prune(e)}this.save()}async ensureLoaded(){if(this.loaded)return;const e=await this.storage.getItem("crossBoundarySubscriptions");if(e)for(let s of Object.getOwnPropertyNames(e)){const t=X.create(e[s],this.runtimeMessagesTarget,this.tabMessagesTargetFactory);t.updated.listen((()=>this.save())),this.subscriptions[s]=t}this.loaded=!0}async save(){await this.storage.setItem("crossBoundarySubscriptions",this.serialize())}serialize(){const e={};for(let s of Object.getOwnPropertyNames(this.subscriptions)){const t=this.subscriptions[s];if(!t)continue;const a=t.serialize();e[s]=a}return e}async addTargetForType(e,s){await this.ensureLoaded();let t=this.subscriptions[e];t||(t=new X([],this.runtimeMessagesTarget),t.updated.listen((()=>this.save())),this.subscriptions[e]=t),t.addTarget(s)}async getTargetForType(e){return await this.ensureLoaded(),this.subscriptions[e]||new X([],this.runtimeMessagesTarget)}}class Z{constructor(e,s){this.target=e,this.source=s}}var ee=new m("crossBoundarySubscription"),se=new m("requestTarget");class te extends w{constructor(e,s){super(),this.type=e,this.messageType=new m(e),this.subscriptionCollection=s}async getTarget(){return(await this.subscriptionCollection.getTargetForType(this.type)).ofType(this.messageType)}sendMessage(e){this.getTarget().then((s=>s.sendMessage(e)))}async sendMessageAsync(e){return(await this.getTarget()).sendMessageAsync(e)}}class ae extends w{constructor(e,s,t,a){super(),this.targetRequestTarget=s,this.type=e,this.messageType=new m(e),this.runtimeMessagesTarget=t,this.tabMessagesTargetFactory=a}async getTarget(){const e=await this.targetRequestTarget.sendMessageAsync({type:this.type});return X.create(e,this.runtimeMessagesTarget,this.tabMessagesTargetFactory).ofType(this.messageType)}sendMessage(e){this.getTarget().then((s=>s.sendMessage(e)))}async sendMessageAsync(e){var s=await this.getTarget();return await s.sendMessageAsync(e)}}class ne extends v{constructor(e,s,t){super();const a=new m(e);this.source=t.ofType(a),this.messageFromNavigationSource=s.navigationMessages.filter((e=>a.filterMessage(e))).map(((e,s,t)=>[a.unpackMessage(e),s,t]))}onMessage(e,s){return this.source.onMessage(e,s)}onMessageFromNavigation(e,s){return this.messageFromNavigationSource.listen(e,s)}}class ie extends v{constructor(e,s,t,a){super();const n=new m(e);this.type=e,this.source=t.ofType(n),this.messageFromNavigationSource=s.navigationMessages.filter((e=>n.filterMessage(e))).map(((e,s,t)=>[n.unpackMessage(e),s,t])),this.subscriptionMessageTarget=a}onMessage(e,s){return this.subscriptionMessageTarget.sendMessage({messageType:this.type}),this.source.onMessage(e,s)}onMessageFromNavigation(e,s){return this.messageFromNavigationSource.listen(e,s)}}class re{constructor(e,s,t){this.subscriptionCollection=e,this.navigationEventProvider=s,this.runtimeMessagesSource=t}createChannel(e){const s=new te(e,this.subscriptionCollection),t=new ne(e,this.navigationEventProvider,this.runtimeMessagesSource);return new Z(s,t)}}class oe{constructor(e,s,t,a,n,i){this.targetRequestTarget=e,this.runtimeMessagesTarget=s,this.runtimeMessagesSource=t,this.navigationEventProvider=a,this.subscriptionMessageTarget=n,this.tabMessagesTargetFactory=i}createChannel(e){const s=new ae(e,this.targetRequestTarget,this.runtimeMessagesTarget,this.tabMessagesTargetFactory),t=new ie(e,this.navigationEventProvider,this.runtimeMessagesSource,this.subscriptionMessageTarget);return new Z(s,t)}}class ce extends w{constructor(e){super(),this.tabId=e}sendMessage(e){chrome.tabs.sendMessage(this.tabId,e)}sendMessageAsync(e){return new Promise(((s,t)=>{chrome.tabs.sendMessage(this.tabId,e,(a=>{var n=chrome.runtime.lastError;n?t(`error when sending message to tab ${this.tabId}. Message: ${JSON.stringify(e)}. Error: ${n.message}`):s(a)}))}))}}const ge=new m("getCurrentNavigation");function ue(e){return e.createChannel("navigationReplaced")}class he{constructor(e,s,t,a){this.getCurrentNavigationMessageTarget=e.ofType(ge),this.navigationReplacedMessage=s,this.navigationEventProvider=t,this.tabCollection=a}static createForBackground(e,s,t,a,n){const i=ue(e);return t.navigationReplaced.listen((({navigationHistoryId:e,newNavigationId:s})=>{i.target.sendMessage({navigationHistoryId:e,newNavigationId:s})})),s.filter(((e,s)=>!!s.tab&&s.tab.id>0&&ge.filterMessage(e))).listen(((e,s,t)=>{t({id:G(s.tab.id,s.frameId,s.url),historyId:K(s.tab.id,s.frameId),tabId:s.tab.id})})),new he(a,i,t,n)}static create(e,s,t,a){const n=ue(e);return new he(s,n,t,a)}getCurrent(){return this.getCurrentNavigationMessageTarget.sendMessageAsync({})}openTab(e){this.tabCollection.openTab(e)}async navigationExists(e){const s=await this.tabCollection.getAllTabs();for(let t of s)if(G(t.id,0,t.url)===e)return!0;return await new Promise((async t=>{let a=!1;await Promise.all(s.map((async s=>{const n=await this.tabCollection.getAllFramesInTab(s.id);if(!a&&n)for(let i of n)if(G(s.id,i.frameId,i.url)===e){a=!0,t(!0);break}}))),a||t(!1)}))}async getNavigationsForTabId(e){const s=await this.tabCollection.getAllFramesInTab(e),t=[],a={};for(let n of s){if(!/^https?:\/\//.test(n.url))continue;let s=new URL(n.url).hostname;void 0!==a[s]?s=`${s} (${++a[s].count})`:a[s]={count:1},t.push({top:0===n.frameId,frameId:n.frameId,url:n.url,id:G(e,n.frameId,n.url),name:s})}return t}async getNavigationsForPopup(){const e=await this.tabCollection.getCurrentlyActiveTab();return await this.getNavigationsForTabId(e.id)}async getNavigation(e){const s=await this.tabCollection.getAllTabs();for(let t of s)if(G(t.id,0,t.url)===e)return new Q(t.id,0,t.url);return await new Promise((async t=>{let a=!1;await Promise.all(s.map((async s=>{const n=await this.tabCollection.getAllFramesInTab(s.id);if(!a&&n)for(let i of n)if(G(s.id,i.frameId,i.url)===e){a=!0,t(new Q(s.id,i.frameId,i.url));break}}))),a||t(null)}))}getPopupTabId(){return this.tabCollection.getPopupTabId()}onReplaced(e,s){return this.navigationReplacedMessage.source.onMessage(e,s)}onDisappeared(e,s){return this.navigationEventProvider.navigationDisappeared.listen(e,s)}onCreated(e,s){return this.navigationEventProvider.navigationCreated.listen(e,s)}whenDisappeared(e){return this.navigationEventProvider.navigationDisappeared.mapAsync((async()=>[await this.navigationExists(e)])).filter((e=>!e)).next()}}var de={getTabId:async()=>chrome.devtools.inspectedWindow.tabId,eval(e,s){var t=new a;return chrome.devtools.inspectedWindow.eval(e,s,((e,s)=>{s?t.reject(s):t.resolve(e)})),t.promise}};const le=new class{download(e){return new Promise(((s,t)=>{chrome.downloads.download(e,(e=>{const a=chrome.runtime.lasError;a?t(a):s(e)}))}))}},pe=new class{constructor(){this.enabled=!1,this.onbeforeunloadListener=e=>{e.preventDefault(),e.returnValue=""}}enable(){this.enabled||(addEventListener("beforeunload",this.onbeforeunloadListener),this.enabled=!0)}disable(){this.enabled&&(removeEventListener("beforeunload",this.onbeforeunloadListener),this.enabled=!1)}},me=new class{createTarget(e){return new ce(e)}},ve=new class extends w{sendMessageAsync(e){return new Promise(((s,t)=>{chrome.runtime.sendMessage(void 0,e,(a=>{var n=chrome.runtime.lastError;n?t(`error when sending message. Message: ${JSON.stringify(e)}. Error: ${n.message}`):s(a)}))}))}sendMessage(e){chrome.runtime.sendMessage(void 0,e)}},we=new class extends n{addListener(e){chrome.runtime.onMessage.addListener(e)}removeListener(e){chrome.runtime.onMessage.removeListener(e)}},be=new class extends v{constructor(e){super(),this.source=e.map(((e,s,t)=>[e,t]))}onMessage(e,s){return this.source.listen(e,s)}}(we),Me=new class{openTab(e){chrome.tabs.create({url:e})}getAllTabs(){return new Promise((e=>chrome.tabs.query({},e)))}getAllFramesInTab(e){return new Promise((s=>chrome.webNavigation.getAllFrames({tabId:e},s)))}getCurrentlyActiveTab(){return new Promise(((e,s)=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{1===t.length?e(t[0]):s(new Error(`looked for the single active tab, but found ${t.length} tabs`))}))}))}getPopupTabId(){return new Promise(((e,s)=>{chrome.tabs.query({lastFocusedWindow:!0,active:!0},(t=>{1===t.length?e(t[0].id):s(new Error(`looked for the single active tab, but found ${t.length} tabs`))}))}))}tabExists(e){return new Promise((s=>{chrome.tabs.get(e,(e=>{var t=chrome.runtime.lastError;s(!!e&&!t)}))}))}},Te=new class{constructor(e,s,t,a){this.navigationCreated=t.map((({tabId:e,frameId:s,url:t})=>[new Q(e,s,t)])),this.navigationMessages=e.filter(((e,s)=>!!s.tab&&s.tab.id>0)).map(((e,{frameId:s,tab:t,url:a},n)=>[e,new Q(t.id,s,t.url),n])),this.navigationReplaced=a.map((({tabId:e,frameId:s,url:t})=>[{navigationHistoryId:K(e,s),newNavigationId:G(e,s,t)}])),this.navigationDisappeared=new o([t,s,a])}}(we,j,$,V),ye=class{static createForBackground(e,s,t,a,n,i,r,o,c){const g=new Y(e,s,a,c);return t.filter(((e,s)=>ee.filterMessage(e)&&!i.isExtension(s))).map(((e,s)=>[ee.unpackMessage(e),c.createTarget(s.tab&&s.tab.id)])).listen((({messageType:e},s)=>{g.addTargetForType(e,s)})),r.listen((()=>g.pruneSubscriptions())),n.ofType(se).onMessage((({type:e},s)=>(g.getTargetForType(e).then((e=>s(e.serialize()))),!0))),new re(g,o,n)}static create(e,s,t,a){const n=e.ofType(se),i=e.ofType(ee);return new oe(n,e,s,t,i,a)}}.create(ve,be,Te,me),fe=he.create(ye,ve,Te,Me),Ie=document.getElementById("iframe"),Ce=class{static createForParent(e,s,t){const a=A.create(e,s);return new O(a,t)}static createForIframe(e,s){const t=A.create(e,s);return new U(t)}}.createForParent(Ie.contentWindow,new class extends n{addListener(e){window.addEventListener("message",e)}removeListener(e){window.removeEventListener("message",e)}},ye);Ce.onDocumentTitleChanged((e=>document.title=e)),Ce.onWindowCloseRequested((()=>window.close())),Ce.onUnsavedChangesWarningEnabled((({enabled:e})=>{e?pe.enable():pe.disable()})),Ce.setNavigationDisappeared(Te.navigationDisappeared),Ce.onRequestNavigationExists((async(e,s)=>{s(await fe.navigationExists(e))})),Ce.onRequestNavigationProperties((async(e,s)=>{const{id:t,historyId:a,url:n,tabId:i,frameId:r}=await fe.getNavigation(e);s({id:t,historyId:a,url:n,tabId:i,frameId:r})})),Ce.onRequestToPushHistoryState(((e,s)=>{const t=new URL(e),a=(t.pathname+t.search).replace(/^\//g,""),n=new URL(location.href);n.searchParams.set("page",a);const i=n.toString();history.pushState("",{},i),s()})),Ce.onRequestToFocusNavigation((async e=>{const s=await fe.getNavigation(e);s&&s.focus()})),Ce.onRequestNavigationsForPopup((async(e,s)=>{s(await fe.getNavigationsForPopup())})),Ce.onRequestPopupTabId((async(e,s)=>{s(await fe.getPopupTabId())})),Ce.onBodySizeChange((({width:e,height:s},t)=>{document.body.style.width=e+"px",document.body.style.height=s+1+"px",Ie.style.width=e+"px",Ie.style.height=s+1+"px",t()})),Ce.onRequestToOpenTab((e=>{fe.openTab(e)})),Ce.onRequestInspectedWindowTabId((async(e,s)=>{s(await de.getTabId())})),Ce.onRequestToDownloadJson((async({object:e,fileName:s})=>{const t=JSON.stringify(e),a=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(a);await le.download({filename:s,url:n,saveAs:!0}),URL.revokeObjectURL(n)})),Ce.onCopyToClipboardMessage((({text:e},s)=>{navigator.clipboard.writeText(e).then((()=>s({})))}));const Se=new class{getURL(e){return chrome.runtime.getURL(e)}},Ae=new URL(location.href).searchParams.get("page"),xe=Se.getURL(Ae);Ie.src=xe}},s={};function t(a){if(s[a])return s[a].exports;var n=s[a]={exports:{}};return e[a](n,n.exports,t),n.exports}return t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(780)})()}));