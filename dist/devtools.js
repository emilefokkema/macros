!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.devtools=t():e.devtools=t()}(this,(function(){return(()=>{"use strict";var e={781:(e,t,s)=>{s.r(t);class n{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class a{listen(e,t){this.addListener(e);var s=()=>this.removeListener(e);return t&&t.onCancelled(s),{cancel:s}}filter(e){return new d(this,e)}map(e){return new l(this,e)}mapAsync(e){return new u(this,e)}compare(e){return new i(this,e)}when(e,t){var s,n=new Promise((e=>{s=e})),a=this.listen((function(){var t=[].slice.apply(arguments);e.apply(null,t)&&(a.cancel(),s(t))}),t);return n}next(e){return this.when((()=>!0),e)}debounce(e){return new R(this,e)}}class i extends a{constructor(e,t){super(),this.source=e,this.getInitialArgs=t}listen(e,t){var s=this.getInitialArgs();return this.source.listen((function(){var t=Array.prototype.slice.apply(arguments),n=e(s,t);return s=t,n}),t)}}class r{constructor(e){this.source=e,this.listenersAndCancellationTokensAndSubscriptions=[]}cancelSubscriptionForListener(e){var t=this.removeListener(e);t&&t.subscription.cancel()}removeListener(e){var t=this.listenersAndCancellationTokensAndSubscriptions.findIndex((t=>t.listener===e));if(-1===t)return null;var[s]=this.listenersAndCancellationTokensAndSubscriptions.splice(t,1);return s}listen(e,t){var s=this.source.listen(e,t),n={listener:e,cancellationToken:t,subscription:s};return t&&t.onCancelled((()=>this.removeListener(e))),this.listenersAndCancellationTokensAndSubscriptions.push(n),{cancel:()=>this.cancelSubscriptionForListener(e)}}cancel(){for(let e of this.listenersAndCancellationTokensAndSubscriptions)e.subscription.cancel()}}class o extends a{constructor(e){super(),this.sourcesAndListeners=e.map((e=>new r(e))),this.listenersAndCancellationTokens=[]}removeListener(e){var t=this.listenersAndCancellationTokens.findIndex((t=>t.listener===e));-1!==t&&this.listenersAndCancellationTokens.splice(t,1)}addSource(e){var t=new r(e);for(let{listener:e,cancellationToken:s}of this.listenersAndCancellationTokens)t.listen(e,s);this.sourcesAndListeners.push(t)}removeSource(e){var t=this.sourcesAndListeners.findIndex((t=>t.source===e));if(-1!==t){var[s]=this.sourcesAndListeners.splice(t,1);s.cancel()}}listen(e,t){for(let s of this.sourcesAndListeners)s.listen(e,t);return t&&t.onCancelled((()=>this.removeListener(e))),this.listenersAndCancellationTokens.push({listener:e,cancellationToken:t}),{cancel:()=>{for(let t of this.sourcesAndListeners)t.cancelSubscriptionForListener(e);this.removeListener(e)}}}}class u extends a{constructor(e,t){super(),this.eventSource=e,this.mapAsync=t}listen(e,t){var s=this;return this.eventSource.listen((function(){var t=Array.prototype.slice.apply(arguments);s.mapAsync(...t).then((t=>{t?e(...t):e()}))}),t)}}class c extends a{constructor(e){super(),this.eventSource=e}listen(e,t){var s=this;return this.eventSource.listen((function(){var t=Array.prototype.slice.apply(arguments),n=s.map(...t);return e(...n)}),t)}}class g extends a{constructor(e){super(),this.eventSource=e}listen(e,t){var s=this;return this.eventSource.listen((function(){var t=Array.prototype.slice.apply(arguments);if(s.filter(...t))return e(...t)}),t)}}class d extends g{constructor(e,t){super(e),this.filter=t}}class l extends c{constructor(e,t){super(e),this.map=t}}class h extends a{constructor(){super(),this.listeners=[]}addListener(e){this.listeners.push(e)}removeListener(e){var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}dispatch(){var e=Array.prototype.slice.apply(arguments);for(let t of this.listeners.slice())t(...e)}}class R extends h{constructor(e,t){super(),this.originalEventSource=e,this.interval=t,this.currentTimeout=void 0,this.subscription=void 0,this.latestArgs=void 0,this.waiting=!1}addListener(e){super.addListener(e),this.start()}removeListener(e){super.removeListener(e),0===this.listeners.length&&this.stop()}renewTimeout(){void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((()=>{this.dispatch(...this.latestArgs),this.waiting=!1,this.currentTimeout=void 0}),this.interval),this.waiting=!0}start(){this.subscription=this.originalEventSource.listen(((...e)=>{this.latestArgs=e,this.renewTimeout()}))}stop(){void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.subscription&&this.subscription.cancel()}}class v{constructor(e){this.type=e}filterMessage(e){return e.type===this.type}unpackMessage(e){return e.message}packMessage(e){return{type:this.type,message:e}}toString(){return this.type}}class p{onMessage(e,t){return{cancel(){}}}nextMessage(e){var t=new n,s=this.onMessage((e=>{s.cancel(),t.resolve(e)}),e);return t.promise}ofType(e){return new m(this,e)}}class f{async sendMessageAsync(e){}sendMessage(e){}ofType(e){return new y(this,e)}}class m extends p{constructor(e,t){super(),this.messagesSource=e,this.messageType=t}onMessage(e,t){return this.messagesSource.onMessage(((t,s)=>{if(this.messageType.filterMessage(t))return e(this.messageType.unpackMessage(t),s)}),t)}}class y extends f{constructor(e,t){super(),this.messagesTarget=e,this.messageType=t}sendMessage(e){this.messagesTarget.sendMessage(this.messageType.packMessage(e))}sendMessageAsync(e){return this.messagesTarget.sendMessageAsync(this.messageType.packMessage(e))}}var T=new class extends a{addListener(e){chrome.devtools.panels.elements.onSelectionChanged.addListener(e)}removeListener(e){chrome.devtools.panels.elements.onSelectionChanged.removeListener(e)}},M={getTabId:async()=>chrome.devtools.inspectedWindow.tabId,eval(e,t){var s=new n;return chrome.devtools.inspectedWindow.eval(e,t,((e,t)=>{t?s.reject(t):s.resolve(e)})),s.promise}},S={createEditorUrl(e,t){var s=new URLSearchParams;e&&s.append("navigationId",e),t&&s.append("ruleId",t);const n=`create-rule.html?${s}`;var a=new URLSearchParams;return a.append("page",n),`sandbox.html?${a}`},getParamsFromHref(e){var t=new URL(e),s=t.searchParams.get("navigationId"),n=t.searchParams.get("ruleId");return{navigationId:s||void 0,ruleId:n?parseInt(n):void 0}},replaceParamsInHref(e,t,s){var n=new URL(e);return n.searchParams.delete("navigationId"),t&&n.searchParams.append("navigationId",t),n.searchParams.delete("ruleId"),s&&n.searchParams.append("ruleId",s),n.toString()}};const A={DELETE_ACTION_TYPE:"delete",REMOVE_CLASS_ACTION_TYPE:"removeClass",REMOVE_STYLE_PROPERTY_ACTION_TYPE:"removeStyleProperty",SELECT_ACTION_TYPE:"select",getDeleteActionDefinition(){return{type:this.DELETE_ACTION_TYPE}},getRemoveClassActionDefinition(e){return{type:this.REMOVE_CLASS_ACTION_TYPE,class:e}},getRemoveStylePropertyActionDefinition(e){return{type:this.REMOVE_STYLE_PROPERTY_ACTION_TYPE,property:e}},getSelectActionDefinition(e,t){return t||(t=this.getDeleteActionDefinition()),{type:this.SELECT_ACTION_TYPE,selector:e,action:t}},getSelectActionActionDefinitionOfType(e){switch(e){case this.DELETE_ACTION_TYPE:return this.getDeleteActionDefinition();case this.REMOVE_CLASS_ACTION_TYPE:return this.getRemoveClassActionDefinition();case this.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return this.getRemoveStylePropertyActionDefinition()}},nodeActionsAreEqual(e,t){if(!e)return!t;if(!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case this.DELETE_ACTION_TYPE:return!0;case this.REMOVE_CLASS_ACTION_TYPE:return e.class===t.class;case this.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return e.property===t.property}},selectActionsAreEqual(e,t){return e.selector===t.selector&&this.nodeActionsAreEqual(e.action,t.action)},actionsAreEqual(e,t){if(!e)return!t;if(!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case this.SELECT_ACTION_TYPE:return this.selectActionsAreEqual(e,t)}return!1},actionIsAchievedByOther(e,t){if(e.type!==t.type)return!1;switch(e.type){case this.DELETE_ACTION_TYPE:return!0;case this.REMOVE_CLASS_ACTION_TYPE:return e.class===t.class;case this.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return e.property===t.property}},rulesAreEqual(e,t){if(!e)return!t;if(!t)return!1;if(e.name!==t.name||e.urlPattern!==t.urlPattern||e.automatic!==t.automatic)return!1;if(e.actions){if(!t.actions)return!1;if(e.actions.length!==t.actions.length)return!1;for(let s=0;s<e.actions.length;s++)if(!this.actionsAreEqual(e.actions[s],t.actions[s]))return!1;return!0}return!t.actions}};class I{constructor(e,t,s,n){this.navigation=e,this.inspectedWindow=t,this.editors=S,this.ruleDefinitions=A,this.page=n,this.rulesForUrlRequest=s.createChannel("requestRulesForUrl"),this.rulesForDownloadRequest=s.createChannel("requestRulesForDownload"),this.urlWithEncodedRuleRequest=s.createChannel("urlWithEncodedRuleRequest"),this.rulesJsonUploadRequest=s.createChannel("uploadRulesJson"),this.rulesForNavigationNotification=s.createChannel("notifyRulesForNavigation"),this.executeRuleMessage=s.createChannel("executeRule"),this.openEditorRequest=s.createChannel("openEditor"),this.ruleByIdRequest=s.createChannel("requestRuleById"),this.allRulesRequest=s.createChannel("requestAllRules"),this.executeActionRequest=s.createChannel("executeAction"),this.editedStatusRequest=s.createChannel("requestEditedStatus"),this.editableStatusRequest=s.createChannel("requestEditableStatus"),this.editorLoadedMessage=s.createChannel("editorLoaded"),this.editedStatusChangedMessage=s.createChannel("editedStatusChanged"),this.saveRuleRequest=s.createChannel("requestSaveRule"),this.deleteRuleRequest=s.createChannel("requestDeleteRule"),this.ruleAddedNotification=s.createChannel("notifyRuleAdded"),this.ruleDeletedNotification=s.createChannel("notifyRuleDeleted"),this.ruleUpdatedNotification=s.createChannel("notifyRuleUpdated"),this.addActionRequest=s.createChannel("requestToAddAction"),this.addSelectActionRequest=s.createChannel("requestToAddSelectAction"),this.addSelectActionToEditorRequest=s.createChannel("requestToAddSelectActionToEditor"),this.getSelectedElementInDevtoolsRequest=s.createChannel("getSelectedElementInDevtoolsRequest"),this.selectedElementInDevtoolsNotification=s.createChannel("selectedElementInDevtoolsNotification"),this.suggestionIndicationStartNotification=s.createChannel("suggestionIndicationStart"),this.suggestionIndicationEndNotification=s.createChannel("suggestionIndicationEnd"),this.executeSuggestionRequest=s.createChannel("executeSuggestion"),this.markSuggestionAsRemovedRequest=s.createChannel("markSuggestionAsRemoved"),this.undoSuggestionRequest=s.createChannel("undoSuggestion"),this.addSuggestionToRuleRequest=s.createChannel("addSuggestionToRuleRequest"),this.addSuggestionToNewRuleRequest=s.createChannel("addSuggestionToNewRuleRequest"),this.getAndRemoveSuggestionRequest=s.createChannel("getAndRemoveSuggestion"),this.getRuleStatesForNavigationRequest=s.createChannel("getRuleStatesForNavigation"),this.ruleStateForNavigationChangeNotification=s.createChannel("ruleStateForNavigationChangeNotification"),this.ruleStateForNavigationRemovedNotification=s.createChannel("ruleStateForNavigationRemovedNotification"),this.getSuggestionsRequest=s.createChannel("getSuggestions"),this.reloadSuggestionsRequest=s.createChannel("reloadSuggestions"),this.newDraftRuleForNavigationRequest=s.createChannel("newDraftRuleForNavigationRequest"),this.draftRuleCreatedNotification=s.createChannel("draftRuleCreatedNotification"),this.draftRulesRemovedNotification=s.createChannel("draftRulesRemovedNotification"),this.draftRuleForNavigationRequest=s.createChannel("draftRuleForNavigationRequest"),this.draftRuleStateForNavigationRequest=s.createChannel("draftRuleStateForNavigationRequest"),this.draftRuleStateForNavigationNotification=s.createChannel("draftRuleStateForNavigationNotification"),this.draftRuleChangedNotification=s.createChannel("draftRuleChangedNotification"),this.executeDraftRuleRequest=s.createChannel("executeDraftRuleRequest")}getRulesForUrl(e){return this.rulesForUrlRequest.target.sendMessageAsync(e)}getRuleById(e){return this.ruleByIdRequest.target.sendMessageAsync(e)}getRulesForDownload(e){return this.rulesForDownloadRequest.target.sendMessageAsync({ruleIds:e})}onGetRulesForDownloadRequest(e,t){return this.rulesForDownloadRequest.source.onMessage(e,t)}getUrlWithEncodedRule(e,t){return this.urlWithEncodedRuleRequest.target.sendMessageAsync({ruleId:e,navigationId:t})}onUrlWithEncodedRuleRequest(e,t){return this.urlWithEncodedRuleRequest.source.onMessage(e,t)}uploadRulesJson(e){return this.rulesJsonUploadRequest.target.sendMessageAsync({jsonString:e})}onUploadRulesJson(e,t){return this.rulesJsonUploadRequest.source.onMessage(e,t)}getAllRules(){return this.allRulesRequest.target.sendMessageAsync({})}onGetRuleByIdRequest(e,t){return this.ruleByIdRequest.source.onMessage(e,t)}onGetAllRulesRequest(e,t){return this.allRulesRequest.source.onMessage(e,t)}onRequestRulesForUrl(e,t){return this.rulesForUrlRequest.source.onMessage(e,t)}notifyRulesForNavigation(e){this.rulesForNavigationNotification.target.sendMessage(e)}onNotifyRulesForNavigation(e,t){return this.rulesForNavigationNotification.source.onMessage(e,t)}executeRuleAsync(e,t){return this.executeRuleMessage.target.sendMessageAsync({navigationId:e,ruleId:t})}onExecuteRuleRequest(e,t){return this.executeRuleMessage.source.onMessage(e,t)}executeActionAsync(e,t){return this.executeActionRequest.target.sendMessageAsync({navigationId:e,action:t})}onExecuteActionRequest(e,t){return this.executeActionRequest.source.onMessage(e,t)}onRequestToOpenEditor(e,t){return this.openEditorRequest.source.onMessage(e,t)}requestToOpenEditor({navigationId:e,ruleId:t}){return this.openEditorRequest.target.sendMessageAsync({navigationId:e,ruleId:t})}openManagementPage(){var e=new URLSearchParams;e.append("page","management.html"),this.navigation.openTab(`sandbox.html?${e}`)}getEditableStatus(e,t){return this.editableStatusRequest.target.sendMessageAsync({ruleId:e,navigationId:t})}onGetEditableStatusRequest(e,t){return this.editableStatusRequest.source.onMessage(e,t)}getEditedStatusAsync(e){return this.editedStatusRequest.target.sendMessageAsync({ruleId:e})}onEditedStatusChanged(e,t){return this.editedStatusChangedMessage.source.onMessage(e,t)}notifyEditedStatusChanged(e){this.editedStatusChangedMessage.target.sendMessage(e)}onEditedStatusRequest(e,t){return this.editedStatusRequest.source.onMessage(e,t)}onEditorLoaded(e,t){return this.editorLoadedMessage.source.onMessageFromNavigation(e,t)}notifyEditorLoaded(e){this.editorLoadedMessage.target.sendMessage(e)}saveRuleAsync(e){return this.saveRuleRequest.target.sendMessageAsync(e)}onSaveRuleRequest(e,t){return this.saveRuleRequest.source.onMessage(e,t)}deleteRuleAsync(e){return this.deleteRuleRequest.target.sendMessageAsync(e)}onDeleteRuleRequest(e,t){return this.deleteRuleRequest.source.onMessage(e,t)}notifyRuleAdded(){this.ruleAddedNotification.target.sendMessage({})}onRuleAdded(e,t){return this.ruleAddedNotification.source.onMessage(e,t)}notifyRuleDeleted(e){this.ruleDeletedNotification.target.sendMessage(e)}onRuleDeleted(e,t){return this.ruleDeletedNotification.source.onMessage(e,t)}notifyRuleUpdated(e){this.ruleUpdatedNotification.target.sendMessage(e)}onRuleUpdated(e,t){return this.ruleUpdatedNotification.source.onMessage(e,t)}requestToAddAction(e){this.addActionRequest.target.sendMessage(e)}onRequestToAddAction(e,t){return this.addActionRequest.source.onMessage(e,t)}addSelectAction(e,t,s){this.addSelectActionRequest.target.sendMessage({navigationId:e,selectorText:t,ruleId:s})}onRequestToAddSelectAction(e,t){return this.addSelectActionRequest.source.onMessage(e,t)}addSelectActionToEditor(e,t,s){this.addSelectActionToEditorRequest.target.sendMessage({navigationId:e,ruleId:t,selectorText:s})}onRequestToAddSelectActionToEditor(e,t){return this.addSelectActionToEditorRequest.source.onMessage(e,t)}getSelectedElementInDevtools(e){return this.getSelectedElementInDevtoolsRequest.target.sendMessageAsync({tabId:e})}onGetSelectedElementInDevtoolsRequest(e,t){return this.getSelectedElementInDevtoolsRequest.source.onMessage(e,t)}notifySelectedElementInDevtools(e){this.selectedElementInDevtoolsNotification.target.sendMessage(e)}onSelectedElementInDevtoolsChange(e,t){return this.selectedElementInDevtoolsNotification.source.onMessage(e,t)}notifySuggestionIndicationStart(e,t){this.suggestionIndicationStartNotification.target.sendMessage({navigationId:e,suggestionId:t})}onNotifySuggestionIndicationStart(e,t){return this.suggestionIndicationStartNotification.source.onMessage(e,t)}notifySuggestionIndicationEnd(e,t){this.suggestionIndicationEndNotification.target.sendMessage({navigationId:e,suggestionId:t})}onNotifySuggestionIndicationEnd(e,t){return this.suggestionIndicationEndNotification.source.onMessage(e,t)}onExecuteSuggestionRequest(e,t){return this.executeSuggestionRequest.source.onMessage(e,t)}executeSuggestion(e,t){return this.executeSuggestionRequest.target.sendMessageAsync({suggestionId:t,navigationId:e})}markSuggestionAsRemoved(e,t){return this.markSuggestionAsRemovedRequest.target.sendMessageAsync({navigationId:e,suggestionId:t})}onMarkSuggestionAsRemoved(e,t){return this.markSuggestionAsRemovedRequest.source.onMessage(e,t)}onUndoSuggestionRequest(e,t){return this.undoSuggestionRequest.source.onMessage(e,t)}undoSuggestion(e,t){return this.undoSuggestionRequest.target.sendMessageAsync({suggestionId:t,navigationId:e})}onAddSuggestionToRuleRequest(e,t){return this.addSuggestionToRuleRequest.source.onMessage(e,t)}requestToAddSuggestionToRule(e,t,s){this.addSuggestionToRuleRequest.target.sendMessage({ruleId:e,navigationId:t,suggestionId:s})}onAddSuggestionToNewRuleRequest(e,t){return this.addSuggestionToNewRuleRequest.source.onMessage(e,t)}requestToAddSuggestionToNewRule(e,t){this.addSuggestionToNewRuleRequest.target.sendMessage({navigationId:e,suggestionId:t})}onGetAndRemoveSuggestionRequest(e,t){return this.getAndRemoveSuggestionRequest.source.onMessage(e,t)}getSuggestions(e){return this.getSuggestionsRequest.target.sendMessageAsync({navigationId:e})}onGetSuggestionsRequest(e,t){return this.getSuggestionsRequest.source.onMessage(e,t)}reloadSuggestions(e){return this.reloadSuggestionsRequest.target.sendMessageAsync({navigationId:e})}onReloadSuggestionsRequest(e,t){return this.reloadSuggestionsRequest.source.onMessage(e,t)}getAndRemoveSuggestion(e,t){return this.getAndRemoveSuggestionRequest.target.sendMessageAsync({suggestionId:e,navigationId:t})}getRuleStatesForNavigation(e){return this.getRuleStatesForNavigationRequest.target.sendMessageAsync({navigationId:e})}onGetRuleStatesForNavigation(e,t){return this.getRuleStatesForNavigationRequest.source.onMessage(e,t)}notifyRuleStateForNavigationChanged(e,t){this.ruleStateForNavigationChangeNotification.target.sendMessage({navigationId:e,state:t})}onRuleStateForNavigationChanged(e,t){return this.ruleStateForNavigationChangeNotification.source.onMessage(e,t)}notifyRuleStateForNavigationRemoved(e,t){this.ruleStateForNavigationRemovedNotification.target.sendMessage({navigationId:e,ruleId:t})}onRuleStateForNavigationRemoved(e,t){return this.ruleStateForNavigationRemovedNotification.source.onMessage(e,t)}createNewDraftRuleForNavigation(e){return this.newDraftRuleForNavigationRequest.target.sendMessageAsync({navigationId:e})}onRequestToCreateNewDraftRuleForNavigation(e,t){return this.newDraftRuleForNavigationRequest.source.onMessage(e,t)}getDraftRuleForNavigation(e){return this.draftRuleForNavigationRequest.target.sendMessageAsync({navigationId:e})}onRequestDraftRuleForNavigation(e,t){return this.draftRuleForNavigationRequest.source.onMessage(e,t)}notifyDraftRuleCreated(e,t){this.draftRuleCreatedNotification.target.sendMessage({navigationId:e,draftRule:t})}onDraftRuleCreated(e,t){return this.draftRuleCreatedNotification.source.onMessage(e,t)}notifyDraftRulesRemoved(e){this.draftRulesRemovedNotification.target.sendMessage(e)}onDraftRulesRemoved(e,t){return this.draftRulesRemovedNotification.source.onMessage(e,t)}getDraftRuleStateForNavigation(e){return this.draftRuleStateForNavigationRequest.target.sendMessageAsync({navigationId:e})}onDraftRuleStateForNavigationRequest(e,t){return this.draftRuleStateForNavigationRequest.source.onMessage(e,t)}notifyDraftRuleStateForNavigation(e,t){this.draftRuleStateForNavigationNotification.target.sendMessage({navigationId:e,draftRuleState:t})}onDraftRuleStateForNavigation(e,t){return this.draftRuleStateForNavigationNotification.source.onMessage(e,t)}onRequestToExecuteDraftRule(e,t){return this.executeDraftRuleRequest.source.onMessage(e,t)}executeDraftRule(e){return this.executeDraftRuleRequest.target.sendMessageAsync({navigationId:e})}onDraftRuleChanged(e,t){return this.draftRuleChangedNotification.source.onMessage(e,t)}notifyDraftRuleChanged(e,t){this.draftRuleChangedNotification.target.sendMessage({navigationId:e,draftRule:t})}}function b(e,t,s){return`${e}:${t}:${s}`}function w(e,t){return`${e}:${t}`}class N{constructor(e,t,s){this.id=b(e,t,s),this.historyId=w(e,t),this.url=s,this.tabId=e,this.frameId=t}focus(){chrome.tabs.update(this.tabId,{active:!0})}}const q=new v("getCurrentNavigation");function E(e){return e.createChannel("navigationReplaced")}class C{constructor(e,t,s,n){this.getCurrentNavigationMessageTarget=e.ofType(q),this.navigationReplacedMessage=t,this.navigationEventProvider=s,this.tabCollection=n}static createForBackground(e,t,s,n,a){const i=E(e);return s.navigationReplaced.listen((({navigationHistoryId:e,newNavigationId:t})=>{i.target.sendMessage({navigationHistoryId:e,newNavigationId:t})})),t.filter(((e,t)=>!!t.tab&&t.tab.id>0&&q.filterMessage(e))).listen(((e,t,s)=>{s({id:b(t.tab.id,t.frameId,t.url),historyId:w(t.tab.id,t.frameId),tabId:t.tab.id})})),new C(n,i,s,a)}static create(e,t,s,n){const a=E(e);return new C(t,a,s,n)}getCurrent(){return this.getCurrentNavigationMessageTarget.sendMessageAsync({})}openTab(e){this.tabCollection.openTab(e)}async navigationExists(e){const t=await this.tabCollection.getAllTabs();for(let s of t)if(b(s.id,0,s.url)===e)return!0;return await new Promise((async s=>{let n=!1;await Promise.all(t.map((async t=>{const a=await this.tabCollection.getAllFramesInTab(t.id);if(!n&&a)for(let i of a)if(b(t.id,i.frameId,i.url)===e){n=!0,s(!0);break}}))),n||s(!1)}))}async getNavigationsForTabId(e){const t=await this.tabCollection.getAllFramesInTab(e),s=[],n={};for(let a of t){if(!/^https?:\/\//.test(a.url))continue;let t=new URL(a.url).hostname;void 0!==n[t]?t=`${t} (${++n[t].count})`:n[t]={count:1},s.push({top:0===a.frameId,frameId:a.frameId,url:a.url,id:b(e,a.frameId,a.url),name:t})}return s}async getNavigationsForPopup(){const e=await this.tabCollection.getCurrentlyActiveTab();return await this.getNavigationsForTabId(e.id)}async getNavigation(e){const t=await this.tabCollection.getAllTabs();for(let s of t)if(b(s.id,0,s.url)===e)return new N(s.id,0,s.url);return await new Promise((async s=>{let n=!1;await Promise.all(t.map((async t=>{const a=await this.tabCollection.getAllFramesInTab(t.id);if(!n&&a)for(let i of a)if(b(t.id,i.frameId,i.url)===e){n=!0,s(new N(t.id,i.frameId,i.url));break}}))),n||s(null)}))}getPopupTabId(){return this.tabCollection.getPopupTabId()}onReplaced(e,t){return this.navigationReplacedMessage.source.onMessage(e,t)}onDisappeared(e,t){return this.navigationEventProvider.navigationDisappeared.listen(e,t)}onCreated(e,t){return this.navigationEventProvider.navigationCreated.listen(e,t)}whenDisappeared(e){return this.navigationEventProvider.navigationDisappeared.mapAsync((async()=>[await this.navigationExists(e)])).filter((e=>!e)).next()}}var F=new class extends a{addListener(e){chrome.tabs.onRemoved.addListener(e)}removeListener(e){chrome.tabs.onRemoved.removeListener(e)}},L=new class extends a{addListener(e){chrome.webNavigation.onCommitted.addListener(e)}removeListener(e){chrome.webNavigation.onCommitted.removeListener(e)}},P=new class extends a{addListener(e){chrome.webNavigation.onHistoryStateUpdated.addListener(e)}removeListener(e){chrome.webNavigation.onHistoryStateUpdated.removeListener(e)}},x=new class extends a{addListener(e){chrome.webNavigation.onReferenceFragmentUpdated.addListener(e)}removeListener(e){chrome.webNavigation.onReferenceFragmentUpdated.removeListener(e)}},D=new o([P,x]);class _ extends f{constructor(e,t){super(),this.tabMessagesTargets=e,this.runtimeMessagesTarget=t,this.updated=new h}prune(e){this.tabMessagesTargets=this.tabMessagesTargets.filter((t=>-1!==e.indexOf(t.tabId)))}getTargets(){return[this.runtimeMessagesTarget].concat(this.tabMessagesTargets)}sendMessageAsync(e){return new Promise((t=>{var s=this.getTargets();for(let n of s)n.sendMessageAsync(e).then((e=>t(e)),(e=>{}))}))}sendMessage(e){for(var t of this.getTargets())t.sendMessage(e)}serialize(){return this.tabMessagesTargets.map((e=>e.tabId))}addTarget(e){this.tabMessagesTargets.some((t=>t.tabId===e.tabId))||(this.tabMessagesTargets.push(e),this.updated.dispatch())}static create(e,t,s){const n=e.map((e=>s.createTarget(e)));return new _(n,t)}}class O{constructor(e,t,s,n){this.storage=e,this.tabCollection=t,this.runtimeMessagesTarget=s,this.tabMessagesTargetFactory=n,this.loaded=!1,this.subscriptions={}}async pruneSubscriptions(){this.ensureLoaded();const e=(await this.tabCollection.getAllTabs()).map((e=>e.id));for(let t of Object.getOwnPropertyNames(this.subscriptions)){const s=this.subscriptions[t];s&&s.prune(e)}this.save()}async ensureLoaded(){if(this.loaded)return;const e=await this.storage.getItem("crossBoundarySubscriptions");if(e)for(let t of Object.getOwnPropertyNames(e)){const s=_.create(e[t],this.runtimeMessagesTarget,this.tabMessagesTargetFactory);s.updated.listen((()=>this.save())),this.subscriptions[t]=s}this.loaded=!0}async save(){await this.storage.setItem("crossBoundarySubscriptions",this.serialize())}serialize(){const e={};for(let t of Object.getOwnPropertyNames(this.subscriptions)){const s=this.subscriptions[t];if(!s)continue;const n=s.serialize();e[t]=n}return e}async addTargetForType(e,t){await this.ensureLoaded();let s=this.subscriptions[e];s||(s=new _([],this.runtimeMessagesTarget),s.updated.listen((()=>this.save())),this.subscriptions[e]=s),s.addTarget(t)}async getTargetForType(e){return await this.ensureLoaded(),this.subscriptions[e]||new _([],this.runtimeMessagesTarget)}}class k{constructor(e,t){this.target=e,this.source=t}}var U=new v("crossBoundarySubscription"),Y=new v("requestTarget");class $ extends f{constructor(e,t){super(),this.type=e,this.messageType=new v(e),this.subscriptionCollection=t}async getTarget(){return(await this.subscriptionCollection.getTargetForType(this.type)).ofType(this.messageType)}sendMessage(e){this.getTarget().then((t=>t.sendMessage(e)))}async sendMessageAsync(e){return(await this.getTarget()).sendMessageAsync(e)}}class B extends f{constructor(e,t,s,n){super(),this.targetRequestTarget=t,this.type=e,this.messageType=new v(e),this.runtimeMessagesTarget=s,this.tabMessagesTargetFactory=n}async getTarget(){const e=await this.targetRequestTarget.sendMessageAsync({type:this.type});return _.create(e,this.runtimeMessagesTarget,this.tabMessagesTargetFactory).ofType(this.messageType)}sendMessage(e){this.getTarget().then((t=>t.sendMessage(e)))}async sendMessageAsync(e){var t=await this.getTarget();return await t.sendMessageAsync(e)}}class j extends p{constructor(e,t,s){super();const n=new v(e);this.source=s.ofType(n),this.messageFromNavigationSource=t.navigationMessages.filter((e=>n.filterMessage(e))).map(((e,t,s)=>[n.unpackMessage(e),t,s]))}onMessage(e,t){return this.source.onMessage(e,t)}onMessageFromNavigation(e,t){return this.messageFromNavigationSource.listen(e,t)}}class W extends p{constructor(e,t,s,n){super();const a=new v(e);this.type=e,this.source=s.ofType(a),this.messageFromNavigationSource=t.navigationMessages.filter((e=>a.filterMessage(e))).map(((e,t,s)=>[a.unpackMessage(e),t,s])),this.subscriptionMessageTarget=n}onMessage(e,t){return this.subscriptionMessageTarget.sendMessage({messageType:this.type}),this.source.onMessage(e,t)}onMessageFromNavigation(e,t){return this.messageFromNavigationSource.listen(e,t)}}class V{constructor(e,t,s){this.subscriptionCollection=e,this.navigationEventProvider=t,this.runtimeMessagesSource=s}createChannel(e){const t=new $(e,this.subscriptionCollection),s=new j(e,this.navigationEventProvider,this.runtimeMessagesSource);return new k(t,s)}}class G{constructor(e,t,s,n,a,i){this.targetRequestTarget=e,this.runtimeMessagesTarget=t,this.runtimeMessagesSource=s,this.navigationEventProvider=n,this.subscriptionMessageTarget=a,this.tabMessagesTargetFactory=i}createChannel(e){const t=new B(e,this.targetRequestTarget,this.runtimeMessagesTarget,this.tabMessagesTargetFactory),s=new W(e,this.navigationEventProvider,this.runtimeMessagesSource,this.subscriptionMessageTarget);return new k(t,s)}}class J extends f{constructor(e){super(),this.tabId=e}sendMessage(e){chrome.tabs.sendMessage(this.tabId,e)}sendMessageAsync(e){return new Promise(((t,s)=>{chrome.tabs.sendMessage(this.tabId,e,(n=>{var a=chrome.runtime.lastError;a?s(`error when sending message to tab ${this.tabId}. Message: ${JSON.stringify(e)}. Error: ${a.message}`):t(n)}))}))}}const H=new class{createTarget(e){return new J(e)}},z=new class extends f{sendMessageAsync(e){return new Promise(((t,s)=>{chrome.runtime.sendMessage(void 0,e,(n=>{var a=chrome.runtime.lastError;a?s(`error when sending message. Message: ${JSON.stringify(e)}. Error: ${a.message}`):t(n)}))}))}sendMessage(e){chrome.runtime.sendMessage(void 0,e)}},K=new class extends a{addListener(e){chrome.runtime.onMessage.addListener(e)}removeListener(e){chrome.runtime.onMessage.removeListener(e)}},Q=new class extends p{constructor(e){super(),this.source=e.map(((e,t,s)=>[e,s]))}onMessage(e,t){return this.source.listen(e,t)}}(K),X=new class{openTab(e){chrome.tabs.create({url:e})}getAllTabs(){return new Promise((e=>chrome.tabs.query({},e)))}getAllFramesInTab(e){return new Promise((t=>chrome.webNavigation.getAllFrames({tabId:e},t)))}getCurrentlyActiveTab(){return new Promise(((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(s=>{1===s.length?e(s[0]):t(new Error(`looked for the single active tab, but found ${s.length} tabs`))}))}))}getPopupTabId(){return new Promise(((e,t)=>{chrome.tabs.query({lastFocusedWindow:!0,active:!0},(s=>{1===s.length?e(s[0].id):t(new Error(`looked for the single active tab, but found ${s.length} tabs`))}))}))}tabExists(e){return new Promise((t=>{chrome.tabs.get(e,(e=>{var s=chrome.runtime.lastError;t(!!e&&!s)}))}))}},Z=new class{constructor(e,t,s,n){this.navigationCreated=s.map((({tabId:e,frameId:t,url:s})=>[new N(e,t,s)])),this.navigationMessages=e.filter(((e,t)=>!!t.tab&&t.tab.id>0)).map(((e,{frameId:t,tab:s,url:n},a)=>[e,new N(s.id,t,s.url),a])),this.navigationReplaced=n.map((({tabId:e,frameId:t,url:s})=>[{navigationHistoryId:w(e,t),newNavigationId:b(e,t,s)}])),this.navigationDisappeared=new o([s,t,n])}}(K,F,L,D),ee=class{static createForBackground(e,t,s,n,a,i,r,o,u){const c=new O(e,t,n,u);return s.filter(((e,t)=>U.filterMessage(e)&&!i.isExtension(t))).map(((e,t)=>[U.unpackMessage(e),u.createTarget(t.tab&&t.tab.id)])).listen((({messageType:e},t)=>{c.addTargetForType(e,t)})),r.listen((()=>c.pruneSubscriptions())),a.ofType(Y).onMessage((({type:e},t)=>(c.getTargetForType(e).then((e=>t(e.serialize()))),!0))),new V(c,o,a)}static create(e,t,s,n){const a=e.ofType(Y),i=e.ofType(U);return new G(a,e,t,s,i,n)}}.create(z,Q,Z,H);!function(e,t,s,a,i){var r=new I(void 0,void 0,i);let o;async function u(t,s){const n={useContentScriptContext:!0};return t.frameId>0&&(n.frameURL=t.url),await e.eval(s,n)}async function c(e){try{await u(e,"contentScript.onElementSelectedInDevtools($0)")}catch(e){}}!async function(){if(o=await e.getTabId(),null===o)return;const t=new URLSearchParams;t.set("tabId",o);const i=`devtools_sidebar.html?${t}`,g=new URLSearchParams;var d,l,h;g.set("page",i),d="RuleTool",l=`sandbox.html?${g}`,h=new n,chrome.devtools.panels.elements.createSidebarPane(d,(function(e){e.setPage(l),h.resolve()})),h.promise,r.onGetSelectedElementInDevtoolsRequest((({tabId:e},t)=>{if(e===o)return async function(){const e=await a.getNavigationsForTabId(o);let t=await Promise.all(e.map((e=>async function(e){try{return await u(e,"contentScript.getElementSelectedInDevtools($0)")}catch(e){return null}}(e))));return t=t.filter((e=>!!e)),t.length>1&&console.warn("unexpected: found selected element in devtools for more than one navigation"),t[0]}().then(t),!0})),s.listen((async()=>{!async function(){const e=await a.getNavigationsForTabId(o);for(let t of e)c(t)}()}))}()}(M,0,T,C.create(ee,z,Z,X),ee)}},t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}return s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(781)})()}));