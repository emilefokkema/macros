!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.contentScript=t():e.contentScript=t()}(this,(function(){return(()=>{var e={850:(e,t,s)=>{var n=s(435);e.exports=n},435:(e,t,s)=>{"use strict";s.r(t),s.d(t,{debugSuggestionsForElement:()=>mt,getElementSelectedInDevtools:()=>pt,onElementSelectedInDevtools:()=>ft});var n={createEditorUrl(e,t){var s=new URLSearchParams;e&&s.append("navigationId",e),t&&s.append("ruleId",t);const n=`create-rule.html?${s}`;var i=new URLSearchParams;return i.append("page",n),`sandbox.html?${i}`},getParamsFromHref(e){var t=new URL(e),s=t.searchParams.get("navigationId"),n=t.searchParams.get("ruleId");return{navigationId:s||void 0,ruleId:n?parseInt(n):void 0}},replaceParamsInHref(e,t,s){var n=new URL(e);return n.searchParams.delete("navigationId"),t&&n.searchParams.append("navigationId",t),n.searchParams.delete("ruleId"),s&&n.searchParams.append("ruleId",s),n.toString()}};const i={DELETE_ACTION_TYPE:"delete",REMOVE_CLASS_ACTION_TYPE:"removeClass",REMOVE_STYLE_PROPERTY_ACTION_TYPE:"removeStyleProperty",SELECT_ACTION_TYPE:"select",getDeleteActionDefinition(){return{type:this.DELETE_ACTION_TYPE}},getRemoveClassActionDefinition(e){return{type:this.REMOVE_CLASS_ACTION_TYPE,class:e}},getRemoveStylePropertyActionDefinition(e){return{type:this.REMOVE_STYLE_PROPERTY_ACTION_TYPE,property:e}},getSelectActionDefinition(e,t){return t||(t=this.getDeleteActionDefinition()),{type:this.SELECT_ACTION_TYPE,selector:e,action:t}},getSelectActionActionDefinitionOfType(e){switch(e){case this.DELETE_ACTION_TYPE:return this.getDeleteActionDefinition();case this.REMOVE_CLASS_ACTION_TYPE:return this.getRemoveClassActionDefinition();case this.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return this.getRemoveStylePropertyActionDefinition()}},nodeActionsAreEqual(e,t){if(!e)return!t;if(!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case this.DELETE_ACTION_TYPE:return!0;case this.REMOVE_CLASS_ACTION_TYPE:return e.class===t.class;case this.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return e.property===t.property}},selectActionsAreEqual(e,t){return e.selector===t.selector&&this.nodeActionsAreEqual(e.action,t.action)},actionsAreEqual(e,t){if(!e)return!t;if(!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case this.SELECT_ACTION_TYPE:return this.selectActionsAreEqual(e,t)}return!1},actionIsAchievedByOther(e,t){if(e.type!==t.type)return!1;switch(e.type){case this.DELETE_ACTION_TYPE:return!0;case this.REMOVE_CLASS_ACTION_TYPE:return e.class===t.class;case this.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return e.property===t.property}},rulesAreEqual(e,t){if(!e)return!t;if(!t)return!1;if(e.name!==t.name||e.urlPattern!==t.urlPattern||e.automatic!==t.automatic)return!1;if(e.actions){if(!t.actions)return!1;if(e.actions.length!==t.actions.length)return!1;for(let s=0;s<e.actions.length;s++)if(!this.actionsAreEqual(e.actions[s],t.actions[s]))return!1;return!0}return!t.actions}};class r{constructor(e,t,s,r){this.navigation=e,this.inspectedWindow=t,this.editors=n,this.ruleDefinitions=i,this.page=r,this.rulesForUrlRequest=s.createChannel("requestRulesForUrl"),this.rulesForDownloadRequest=s.createChannel("requestRulesForDownload"),this.urlWithEncodedRuleRequest=s.createChannel("urlWithEncodedRuleRequest"),this.rulesJsonUploadRequest=s.createChannel("uploadRulesJson"),this.rulesForNavigationNotification=s.createChannel("notifyRulesForNavigation"),this.executeRuleMessage=s.createChannel("executeRule"),this.openEditorRequest=s.createChannel("openEditor"),this.ruleByIdRequest=s.createChannel("requestRuleById"),this.allRulesRequest=s.createChannel("requestAllRules"),this.executeActionRequest=s.createChannel("executeAction"),this.editedStatusRequest=s.createChannel("requestEditedStatus"),this.editableStatusRequest=s.createChannel("requestEditableStatus"),this.editorLoadedMessage=s.createChannel("editorLoaded"),this.editedStatusChangedMessage=s.createChannel("editedStatusChanged"),this.saveRuleRequest=s.createChannel("requestSaveRule"),this.deleteRuleRequest=s.createChannel("requestDeleteRule"),this.ruleAddedNotification=s.createChannel("notifyRuleAdded"),this.ruleDeletedNotification=s.createChannel("notifyRuleDeleted"),this.ruleUpdatedNotification=s.createChannel("notifyRuleUpdated"),this.addActionRequest=s.createChannel("requestToAddAction"),this.addSelectActionRequest=s.createChannel("requestToAddSelectAction"),this.addSelectActionToEditorRequest=s.createChannel("requestToAddSelectActionToEditor"),this.getSelectedElementInDevtoolsRequest=s.createChannel("getSelectedElementInDevtoolsRequest"),this.selectedElementInDevtoolsNotification=s.createChannel("selectedElementInDevtoolsNotification"),this.suggestionIndicationStartNotification=s.createChannel("suggestionIndicationStart"),this.suggestionIndicationEndNotification=s.createChannel("suggestionIndicationEnd"),this.executeSuggestionRequest=s.createChannel("executeSuggestion"),this.markSuggestionAsRemovedRequest=s.createChannel("markSuggestionAsRemoved"),this.undoSuggestionRequest=s.createChannel("undoSuggestion"),this.addSuggestionToRuleRequest=s.createChannel("addSuggestionToRuleRequest"),this.addSuggestionToNewRuleRequest=s.createChannel("addSuggestionToNewRuleRequest"),this.getAndRemoveSuggestionRequest=s.createChannel("getAndRemoveSuggestion"),this.getRuleStatesForNavigationRequest=s.createChannel("getRuleStatesForNavigation"),this.ruleStateForNavigationChangeNotification=s.createChannel("ruleStateForNavigationChangeNotification"),this.ruleStateForNavigationRemovedNotification=s.createChannel("ruleStateForNavigationRemovedNotification"),this.getSuggestionsRequest=s.createChannel("getSuggestions"),this.reloadSuggestionsRequest=s.createChannel("reloadSuggestions"),this.newDraftRuleForNavigationRequest=s.createChannel("newDraftRuleForNavigationRequest"),this.draftRuleCreatedNotification=s.createChannel("draftRuleCreatedNotification"),this.draftRulesRemovedNotification=s.createChannel("draftRulesRemovedNotification"),this.draftRuleForNavigationRequest=s.createChannel("draftRuleForNavigationRequest"),this.draftRuleStateForNavigationRequest=s.createChannel("draftRuleStateForNavigationRequest"),this.draftRuleStateForNavigationNotification=s.createChannel("draftRuleStateForNavigationNotification"),this.draftRuleChangedNotification=s.createChannel("draftRuleChangedNotification"),this.executeDraftRuleRequest=s.createChannel("executeDraftRuleRequest")}getRulesForUrl(e){return this.rulesForUrlRequest.target.sendMessageAsync(e)}getRuleById(e){return this.ruleByIdRequest.target.sendMessageAsync(e)}getRulesForDownload(e){return this.rulesForDownloadRequest.target.sendMessageAsync({ruleIds:e})}onGetRulesForDownloadRequest(e,t){return this.rulesForDownloadRequest.source.onMessage(e,t)}getUrlWithEncodedRule(e,t){return this.urlWithEncodedRuleRequest.target.sendMessageAsync({ruleId:e,navigationId:t})}onUrlWithEncodedRuleRequest(e,t){return this.urlWithEncodedRuleRequest.source.onMessage(e,t)}uploadRulesJson(e){return this.rulesJsonUploadRequest.target.sendMessageAsync({jsonString:e})}onUploadRulesJson(e,t){return this.rulesJsonUploadRequest.source.onMessage(e,t)}getAllRules(){return this.allRulesRequest.target.sendMessageAsync({})}onGetRuleByIdRequest(e,t){return this.ruleByIdRequest.source.onMessage(e,t)}onGetAllRulesRequest(e,t){return this.allRulesRequest.source.onMessage(e,t)}onRequestRulesForUrl(e,t){return this.rulesForUrlRequest.source.onMessage(e,t)}notifyRulesForNavigation(e){this.rulesForNavigationNotification.target.sendMessage(e)}onNotifyRulesForNavigation(e,t){return this.rulesForNavigationNotification.source.onMessage(e,t)}executeRuleAsync(e,t){return this.executeRuleMessage.target.sendMessageAsync({navigationId:e,ruleId:t})}onExecuteRuleRequest(e,t){return this.executeRuleMessage.source.onMessage(e,t)}executeActionAsync(e,t){return this.executeActionRequest.target.sendMessageAsync({navigationId:e,action:t})}onExecuteActionRequest(e,t){return this.executeActionRequest.source.onMessage(e,t)}onRequestToOpenEditor(e,t){return this.openEditorRequest.source.onMessage(e,t)}requestToOpenEditor({navigationId:e,ruleId:t}){return this.openEditorRequest.target.sendMessageAsync({navigationId:e,ruleId:t})}openManagementPage(){var e=new URLSearchParams;e.append("page","management.html"),this.navigation.openTab(`sandbox.html?${e}`)}getEditableStatus(e,t){return this.editableStatusRequest.target.sendMessageAsync({ruleId:e,navigationId:t})}onGetEditableStatusRequest(e,t){return this.editableStatusRequest.source.onMessage(e,t)}getEditedStatusAsync(e){return this.editedStatusRequest.target.sendMessageAsync({ruleId:e})}onEditedStatusChanged(e,t){return this.editedStatusChangedMessage.source.onMessage(e,t)}notifyEditedStatusChanged(e){this.editedStatusChangedMessage.target.sendMessage(e)}onEditedStatusRequest(e,t){return this.editedStatusRequest.source.onMessage(e,t)}onEditorLoaded(e,t){return this.editorLoadedMessage.source.onMessageFromNavigation(e,t)}notifyEditorLoaded(e){this.editorLoadedMessage.target.sendMessage(e)}saveRuleAsync(e){return this.saveRuleRequest.target.sendMessageAsync(e)}onSaveRuleRequest(e,t){return this.saveRuleRequest.source.onMessage(e,t)}deleteRuleAsync(e){return this.deleteRuleRequest.target.sendMessageAsync(e)}onDeleteRuleRequest(e,t){return this.deleteRuleRequest.source.onMessage(e,t)}notifyRuleAdded(){this.ruleAddedNotification.target.sendMessage({})}onRuleAdded(e,t){return this.ruleAddedNotification.source.onMessage(e,t)}notifyRuleDeleted(e){this.ruleDeletedNotification.target.sendMessage(e)}onRuleDeleted(e,t){return this.ruleDeletedNotification.source.onMessage(e,t)}notifyRuleUpdated(e){this.ruleUpdatedNotification.target.sendMessage(e)}onRuleUpdated(e,t){return this.ruleUpdatedNotification.source.onMessage(e,t)}requestToAddAction(e){this.addActionRequest.target.sendMessage(e)}onRequestToAddAction(e,t){return this.addActionRequest.source.onMessage(e,t)}addSelectAction(e,t,s){this.addSelectActionRequest.target.sendMessage({navigationId:e,selectorText:t,ruleId:s})}onRequestToAddSelectAction(e,t){return this.addSelectActionRequest.source.onMessage(e,t)}addSelectActionToEditor(e,t,s){this.addSelectActionToEditorRequest.target.sendMessage({navigationId:e,ruleId:t,selectorText:s})}onRequestToAddSelectActionToEditor(e,t){return this.addSelectActionToEditorRequest.source.onMessage(e,t)}getSelectedElementInDevtools(e){return this.getSelectedElementInDevtoolsRequest.target.sendMessageAsync({tabId:e})}onGetSelectedElementInDevtoolsRequest(e,t){return this.getSelectedElementInDevtoolsRequest.source.onMessage(e,t)}notifySelectedElementInDevtools(e){this.selectedElementInDevtoolsNotification.target.sendMessage(e)}onSelectedElementInDevtoolsChange(e,t){return this.selectedElementInDevtoolsNotification.source.onMessage(e,t)}notifySuggestionIndicationStart(e,t){this.suggestionIndicationStartNotification.target.sendMessage({navigationId:e,suggestionId:t})}onNotifySuggestionIndicationStart(e,t){return this.suggestionIndicationStartNotification.source.onMessage(e,t)}notifySuggestionIndicationEnd(e,t){this.suggestionIndicationEndNotification.target.sendMessage({navigationId:e,suggestionId:t})}onNotifySuggestionIndicationEnd(e,t){return this.suggestionIndicationEndNotification.source.onMessage(e,t)}onExecuteSuggestionRequest(e,t){return this.executeSuggestionRequest.source.onMessage(e,t)}executeSuggestion(e,t){return this.executeSuggestionRequest.target.sendMessageAsync({suggestionId:t,navigationId:e})}markSuggestionAsRemoved(e,t){return this.markSuggestionAsRemovedRequest.target.sendMessageAsync({navigationId:e,suggestionId:t})}onMarkSuggestionAsRemoved(e,t){return this.markSuggestionAsRemovedRequest.source.onMessage(e,t)}onUndoSuggestionRequest(e,t){return this.undoSuggestionRequest.source.onMessage(e,t)}undoSuggestion(e,t){return this.undoSuggestionRequest.target.sendMessageAsync({suggestionId:t,navigationId:e})}onAddSuggestionToRuleRequest(e,t){return this.addSuggestionToRuleRequest.source.onMessage(e,t)}requestToAddSuggestionToRule(e,t,s){this.addSuggestionToRuleRequest.target.sendMessage({ruleId:e,navigationId:t,suggestionId:s})}onAddSuggestionToNewRuleRequest(e,t){return this.addSuggestionToNewRuleRequest.source.onMessage(e,t)}requestToAddSuggestionToNewRule(e,t){this.addSuggestionToNewRuleRequest.target.sendMessage({navigationId:e,suggestionId:t})}onGetAndRemoveSuggestionRequest(e,t){return this.getAndRemoveSuggestionRequest.source.onMessage(e,t)}getSuggestions(e){return this.getSuggestionsRequest.target.sendMessageAsync({navigationId:e})}onGetSuggestionsRequest(e,t){return this.getSuggestionsRequest.source.onMessage(e,t)}reloadSuggestions(e){return this.reloadSuggestionsRequest.target.sendMessageAsync({navigationId:e})}onReloadSuggestionsRequest(e,t){return this.reloadSuggestionsRequest.source.onMessage(e,t)}getAndRemoveSuggestion(e,t){return this.getAndRemoveSuggestionRequest.target.sendMessageAsync({suggestionId:e,navigationId:t})}getRuleStatesForNavigation(e){return this.getRuleStatesForNavigationRequest.target.sendMessageAsync({navigationId:e})}onGetRuleStatesForNavigation(e,t){return this.getRuleStatesForNavigationRequest.source.onMessage(e,t)}notifyRuleStateForNavigationChanged(e,t){this.ruleStateForNavigationChangeNotification.target.sendMessage({navigationId:e,state:t})}onRuleStateForNavigationChanged(e,t){return this.ruleStateForNavigationChangeNotification.source.onMessage(e,t)}notifyRuleStateForNavigationRemoved(e,t){this.ruleStateForNavigationRemovedNotification.target.sendMessage({navigationId:e,ruleId:t})}onRuleStateForNavigationRemoved(e,t){return this.ruleStateForNavigationRemovedNotification.source.onMessage(e,t)}createNewDraftRuleForNavigation(e){return this.newDraftRuleForNavigationRequest.target.sendMessageAsync({navigationId:e})}onRequestToCreateNewDraftRuleForNavigation(e,t){return this.newDraftRuleForNavigationRequest.source.onMessage(e,t)}getDraftRuleForNavigation(e){return this.draftRuleForNavigationRequest.target.sendMessageAsync({navigationId:e})}onRequestDraftRuleForNavigation(e,t){return this.draftRuleForNavigationRequest.source.onMessage(e,t)}notifyDraftRuleCreated(e,t){this.draftRuleCreatedNotification.target.sendMessage({navigationId:e,draftRule:t})}onDraftRuleCreated(e,t){return this.draftRuleCreatedNotification.source.onMessage(e,t)}notifyDraftRulesRemoved(e){this.draftRulesRemovedNotification.target.sendMessage(e)}onDraftRulesRemoved(e,t){return this.draftRulesRemovedNotification.source.onMessage(e,t)}getDraftRuleStateForNavigation(e){return this.draftRuleStateForNavigationRequest.target.sendMessageAsync({navigationId:e})}onDraftRuleStateForNavigationRequest(e,t){return this.draftRuleStateForNavigationRequest.source.onMessage(e,t)}notifyDraftRuleStateForNavigation(e,t){this.draftRuleStateForNavigationNotification.target.sendMessage({navigationId:e,draftRuleState:t})}onDraftRuleStateForNavigation(e,t){return this.draftRuleStateForNavigationNotification.source.onMessage(e,t)}onRequestToExecuteDraftRule(e,t){return this.executeDraftRuleRequest.source.onMessage(e,t)}executeDraftRule(e){return this.executeDraftRuleRequest.target.sendMessageAsync({navigationId:e})}onDraftRuleChanged(e,t){return this.draftRuleChangedNotification.source.onMessage(e,t)}notifyDraftRuleChanged(e,t){this.draftRuleChangedNotification.target.sendMessage({navigationId:e,draftRule:t})}}class o{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class a{listen(e,t){this.addListener(e);var s=()=>this.removeListener(e);return t&&t.onCancelled(s),{cancel:s}}filter(e){return new f(this,e)}map(e){return new m(this,e)}mapAsync(e){return new d(this,e)}compare(e){return new u(this,e)}when(e,t){var s,n=new Promise((e=>{s=e})),i=this.listen((function(){var t=[].slice.apply(arguments);e.apply(null,t)&&(i.cancel(),s(t))}),t);return n}next(e){return this.when((()=>!0),e)}debounce(e){return new v(this,e)}}class u extends a{constructor(e,t){super(),this.source=e,this.getInitialArgs=t}listen(e,t){var s=this.getInitialArgs();return this.source.listen((function(){var t=Array.prototype.slice.apply(arguments),n=e(s,t);return s=t,n}),t)}}class l{constructor(e){this.source=e,this.listenersAndCancellationTokensAndSubscriptions=[]}cancelSubscriptionForListener(e){var t=this.removeListener(e);t&&t.subscription.cancel()}removeListener(e){var t=this.listenersAndCancellationTokensAndSubscriptions.findIndex((t=>t.listener===e));if(-1===t)return null;var[s]=this.listenersAndCancellationTokensAndSubscriptions.splice(t,1);return s}listen(e,t){var s=this.source.listen(e,t),n={listener:e,cancellationToken:t,subscription:s};return t&&t.onCancelled((()=>this.removeListener(e))),this.listenersAndCancellationTokensAndSubscriptions.push(n),{cancel:()=>this.cancelSubscriptionForListener(e)}}cancel(){for(let e of this.listenersAndCancellationTokensAndSubscriptions)e.subscription.cancel()}}class c extends a{constructor(e){super(),this.sourcesAndListeners=e.map((e=>new l(e))),this.listenersAndCancellationTokens=[]}removeListener(e){var t=this.listenersAndCancellationTokens.findIndex((t=>t.listener===e));-1!==t&&this.listenersAndCancellationTokens.splice(t,1)}addSource(e){var t=new l(e);for(let{listener:e,cancellationToken:s}of this.listenersAndCancellationTokens)t.listen(e,s);this.sourcesAndListeners.push(t)}removeSource(e){var t=this.sourcesAndListeners.findIndex((t=>t.source===e));if(-1!==t){var[s]=this.sourcesAndListeners.splice(t,1);s.cancel()}}listen(e,t){for(let s of this.sourcesAndListeners)s.listen(e,t);return t&&t.onCancelled((()=>this.removeListener(e))),this.listenersAndCancellationTokens.push({listener:e,cancellationToken:t}),{cancel:()=>{for(let t of this.sourcesAndListeners)t.cancelSubscriptionForListener(e);this.removeListener(e)}}}}class d extends a{constructor(e,t){super(),this.eventSource=e,this.mapAsync=t}listen(e,t){var s=this;return this.eventSource.listen((function(){var t=Array.prototype.slice.apply(arguments);s.mapAsync(...t).then((t=>{t?e(...t):e()}))}),t)}}class h extends a{constructor(e){super(),this.eventSource=e}listen(e,t){var s=this;return this.eventSource.listen((function(){var t=Array.prototype.slice.apply(arguments),n=s.map(...t);return e(...n)}),t)}}class g extends a{constructor(e){super(),this.eventSource=e}listen(e,t){var s=this;return this.eventSource.listen((function(){var t=Array.prototype.slice.apply(arguments);if(s.filter(...t))return e(...t)}),t)}}class f extends g{constructor(e,t){super(e),this.filter=t}}class m extends h{constructor(e,t){super(e),this.map=t}}class p extends a{constructor(){super(),this.listeners=[]}addListener(e){this.listeners.push(e)}removeListener(e){var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}dispatch(){var e=Array.prototype.slice.apply(arguments);for(let t of this.listeners.slice())t(...e)}}class v extends p{constructor(e,t){super(),this.originalEventSource=e,this.interval=t,this.currentTimeout=void 0,this.subscription=void 0,this.latestArgs=void 0,this.waiting=!1}addListener(e){super.addListener(e),this.start()}removeListener(e){super.removeListener(e),0===this.listeners.length&&this.stop()}renewTimeout(){void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((()=>{this.dispatch(...this.latestArgs),this.waiting=!1,this.currentTimeout=void 0}),this.interval),this.waiting=!0}start(){this.subscription=this.originalEventSource.listen(((...e)=>{this.latestArgs=e,this.renewTimeout()}))}stop(){void 0!==this.currentTimeout&&clearTimeout(this.currentTimeout),this.subscription&&this.subscription.cancel()}}class R extends p{constructor(){super(),this.cancelled=!1}dispatch(){if(!this.cancelled){this.cancelled=!0;for(let e of this.listeners)e();this.listeners=[]}}onCancelled(e){return this.listen(e)}cancel(){this.dispatch()}}class y{constructor(e){this.type=e}filterMessage(e){return e.type===this.type}unpackMessage(e){return e.message}packMessage(e){return{type:this.type,message:e}}toString(){return this.type}}class S{onMessage(e,t){return{cancel(){}}}nextMessage(e){var t=new o,s=this.onMessage((e=>{s.cancel(),t.resolve(e)}),e);return t.promise}ofType(e){return new w(this,e)}}class E{async sendMessageAsync(e){}sendMessage(e){}ofType(e){return new b(this,e)}}class w extends S{constructor(e,t){super(),this.messagesSource=e,this.messageType=t}onMessage(e,t){return this.messagesSource.onMessage(((t,s)=>{if(this.messageType.filterMessage(t))return e(this.messageType.unpackMessage(t),s)}),t)}}class b extends E{constructor(e,t){super(),this.messagesTarget=e,this.messageType=t}sendMessage(e){this.messagesTarget.sendMessage(this.messageType.packMessage(e))}sendMessageAsync(e){return this.messagesTarget.sendMessageAsync(this.messageType.packMessage(e))}}class I{constructor(e,t,s,n,i){this.text=e,this.nodeName=t,this.id=s,this.classes=n,this.attributeNames=i}static forElement(e){var t,s=[],n=e.localName||"",i=[];try{i=e.getAttributeNames()}catch(t){console.log("could not getAttributeNames() for element",e)}var r="",o="";for(let n of i)"id"===n?t=e.getAttribute("id"):"class"===n?o=(s=(e.getAttribute("class")||"").match(/\S+/g)||[]).map((e=>`.${e.replace(/[\.:]/g,"\\$&")}`)).join(""):r+=`[${n}]`;return new I(`${n}${t?`#${t}`:""}${o}${r}`,n,t,s,i)}static create(e){for(var t,s,n,i=[],r=!1,o=[],a=!1,u=/(?:^([^\.\[#]+))|(?:#([^\.\[]+))|(?:\.([^#\.\[]+))|\[([^=]+)(?:=(?:"[^"]*"|[^\]]+))?\]/g;null!==(n=u.exec(e));)n[1]?t=n[1]:n[2]?(r=!0,s=n[2]):n[3]?(a=!0,o.push(n[3])):n[4]&&i.push(n[4]);return r&&!i.some((e=>"id"===e))&&i.push("id"),a&&!i.some((e=>"class"===e))&&i.push("class"),new I(e,t,s,o,i)}static isValidSelector(e){try{return document.querySelector(e),!0}catch(e){return!1}}}class T{execute(){}}class A{constructor(e,t,s){this.removedNode=e,this.nextSibling=t,this.parent=s}execute(){this.nextSibling&&this.nextSibling.parentNode===this.parent?this.parent.insertBefore(this.removedNode,this.nextSibling):this.parent.appendChild(this.removedNode)}}class x{constructor(e,t){this.node=e,this.className=t}execute(){this.node.classList.add(this.className)}}class N{constructor(e,t,s){this.node=e,this.propertyName=t,this.propertyValue=s}execute(){this.node.style.setProperty(this.propertyName,this.propertyValue)}}class M{constructor(){this.undoings=[]}add(e){this.undoings.push(e)}execute(){for(let e=this.undoings.length-1;e>=0;e--)this.undoings[e].execute()}}class P{getEffectOnNode(e){return{description:"will delete this element",actionDefinition:i.getDeleteActionDefinition()}}hasEffectOnNode(e){return!0}execute(e){if(!e||!e.isConnected)return new T;try{const t=e.nextElementSibling,s=e.parentNode;return e.remove(),new A(e,t,s)}catch(e){return new T}}}class F{constructor(e){this.class=e.class}getEffectOnNode(e){return this.hasEffectOnNode(e)?{description:`will remove class '${this.class}' from this element`,actionDefinition:i.getRemoveClassActionDefinition(this.class)}:null}hasEffectOnNode(e){return e.classList&&e.classList.contains(this.class)}execute(e){return e&&e.classList?(e.classList.remove(this.class),new x(e,this.class)):new T}}class C{constructor(e){this.property=e.property}getEffectOnNode(e){return this.hasEffectOnNode(e)?{description:`will remove property '${this.property}' from this element's style declaration`,actionDefinition:i.getRemoveStylePropertyActionDefinition(this.property)}:null}nodeStyleDeclarationContainsProperty(e){for(var t=0;t<e.style.length;t++)if(e.style[t]===this.property)return!0;return!1}execute(e){if(!this.nodeStyleDeclarationContainsProperty(e))return new T;const t=e.style.getPropertyValue(this.property);return e.style.removeProperty(this.property),new N(e,this.property,t)}hasEffectOnNode(e){return this.nodeStyleDeclarationContainsProperty(e)}}class D{constructor(e,t){this.selector=I.create(e.selector),this.action=function(e){switch(e.type){case i.DELETE_ACTION_TYPE:return new P(e);case i.REMOVE_CLASS_ACTION_TYPE:return new F(e);case i.REMOVE_STYLE_PROPERTY_ACTION_TYPE:return new C(e)}}(e.action),this.hasSomethingToDoChanged=t.getMutations(this.selector.attributeNames).map((()=>[this.hasSomethingToDo()])).compare((()=>[this.hasSomethingToDo()])).filter((([e],[t])=>e!==t)),this.effectOnElementSelectedInDevtools=null,this.effectOnElementSelectedInDevtoolsChanged=new p}getEffectOnNode(e){return e.matches(this.selector.text)?this.action.getEffectOnNode(e):null}addEffectForElementSelectedInDevtools(e){const t=e&&e.matches(this.selector.text)?this.action.getEffectOnNode(e):null;null==t&&null==this.effectOnElementSelectedInDevtools||(this.effectOnElementSelectedInDevtools=t,this.effectOnElementSelectedInDevtoolsChanged.dispatch())}hasSomethingToDo(){var e=document.querySelectorAll(this.selector.text);if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(this.action.hasEffectOnNode(e[t]))return!0;return!1}execute(){try{var e=document.querySelectorAll(this.selector.text);if(0===e.length)return;console.log(`executing rule for ${e.length} nodes matching ${this.selector.text}`);const s=new M;for(var t=0;t<e.length;t++)s.add(this.action.execute(e[t]));return s}catch(e){return new T}}}function q(e,t){switch(e.type){case i.SELECT_ACTION_TYPE:return new D(e,t)}}class O{constructor(e,t,s){this.id=e.id,this.name=e.name,this.automatic=!!e.automatic,this.actions=e.actions.map((e=>q(e,t))),this.hasExecuted=!1,this.editable=s,this.hasSomethingToDoChanged=new c(this.actions.map((e=>e.hasSomethingToDoChanged))).map((()=>[this.hasSomethingToDo()])).compare((()=>[this.hasSomethingToDo()])).filter((([e],[t])=>e!==t)).map((([e],[t])=>[t])),this.effectOnElementSelectedInDevtoolsChanged=new c(this.actions.map((e=>e.effectOnElementSelectedInDevtoolsChanged))),this.editableChanged=new p}getNotification(){return{name:this.name,id:this.id,hasSomethingToDo:this.hasSomethingToDo(),hasExecuted:this.hasExecuted}}getState(){return{name:this.name,id:this.id,hasSomethingToDo:this.hasSomethingToDo(),hasExecuted:this.hasExecuted,editable:this.editable,effectsOnElement:this.actions.map((e=>e.effectOnElementSelectedInDevtools)).filter((e=>!!e))}}hasSomethingToDo(){for(let e of this.actions)if(e.hasSomethingToDo())return!0;return!1}execute(){for(let e of this.actions)e.execute();this.hasExecuted=!0}setEditable(e){e!==this.editable&&(this.editable=e,this.editableChanged.dispatch())}addEffectsForElementSelectedInDevtools(e){for(let t of this.actions)t.addEffectForElementSelectedInDevtools(e)}getEffectOnNode(e){return this.actions.map((t=>t.getEffectOnNode(e))).filter((e=>!!e))}}class L{constructor(e,t){this.macros=e,this.documentMutationsProvider=t,this.ruleEventSubscriptions=[],this.draftRuleEventSubscriptions=[],this.ruleHasSomethingToDoChanged=new p,this.draftRuleHasSomethingToDoChanged=new p,this.effectOnElementSelectedInDevtoolsChanged=new p,this.ruleEditableChanged=new p,this.effectOfDraftRuleOnElementSelectedInDevtoolsChanged=new p,this.collectionUpdated=new p,this.ruleAdded=new p,this.ruleRemoved=new p,this.ruleExecuted=new p,this.notifications=new c([this.collectionUpdated,this.ruleHasSomethingToDoChanged]).map((()=>[this.getNotification()])),this.rules=[],this.draftRule=void 0,this.automaticExecutions=[]}async refresh(e,t,s){var n=await this.macros.getRulesForUrl(e),i=await this.macros.getDraftRuleForNavigation(t);this.setDraftRuleForDefinition(i);var r=this.rules.map((e=>e.id)),o=r.filter((e=>!n.some((t=>t.id===e)))),a=!1;for(let e of o)this.removeRuleInternal(e),a=!0;var u=n.filter((e=>!r.some((t=>t===e.id))));for(let e of u)await this.addRuleForDefinition(e,t,s),this.ruleAdded.dispatch({ruleId:e.id}),a=!0;a&&this.collectionUpdated.dispatch()}stopAutomaticRuleExecution(e){var t=this.automaticExecutions.findIndex((t=>t.ruleId===e));if(-1!==t){var[{cancellationToken:s}]=this.automaticExecutions.splice(t,1);s.cancel()}}cancelRuleEventSubscriptions(e){const t=this.ruleEventSubscriptions.findIndex((t=>t.ruleId===e));if(-1===t)return;const[s]=this.ruleEventSubscriptions.splice(t,1);for(let e of s.subscriptions)e.cancel()}async executeAutomatically(e,t){for(;;){if(t.cancelled){console.log(`stopping automatic execution of rule '${e.name}'`);break}if(e.hasSomethingToDo()||(console.log(`waiting until rule '${e.name}' has something to do before executing automatically`),await e.hasSomethingToDoChanged.when((e=>e),t)),t.cancelled){console.log(`stopping automatic execution of rule '${e.name}'`);break}if(console.log(`executing rule '${e.name}' automatically`),e.execute(),this.ruleExecuted.dispatch({ruleId:e.id}),e.hasSomethingToDo()){console.log(`after executing, rule '${e.name}' still has something to do; stopping automatic execution`);break}}}getRule(e){return this.rules.find((t=>t.id===e))}executeDraftRule(){this.draftRule&&this.draftRule.execute()}executeRule(e){const t=this.rules.find((t=>t.id===e));t&&(t.execute(),this.ruleExecuted.dispatch({ruleId:t.id}))}setEditable(e,t){const s=this.rules.find((t=>t.id===e));s&&s.setEditable(t)}addEffectsForElementSelectedInDevtools(e){for(let t of this.rules)t.addEffectsForElementSelectedInDevtools(e);this.draftRule&&this.draftRule.addEffectsForElementSelectedInDevtools(e)}setDraftRuleForDefinition(e,t){for(let e of this.draftRuleEventSubscriptions)e.cancel();this.draftRuleEventSubscriptions=[],e?(this.draftRule=new O(e,this.documentMutationsProvider,!0),this.draftRule.addEffectsForElementSelectedInDevtools(t),this.draftRuleEventSubscriptions=[this.draftRule.hasSomethingToDoChanged.listen((e=>{this.draftRuleHasSomethingToDoChanged.dispatch({hasSomethingToDo:e})})),this.draftRule.effectOnElementSelectedInDevtoolsChanged.listen((()=>{this.effectOfDraftRuleOnElementSelectedInDevtoolsChanged.dispatch()}))]):this.draftRule=void 0}async addRuleForDefinition(e,t,s){const n=await this.macros.getEditableStatus(e.id,t);var i=new O(e,this.documentMutationsProvider,n);if(i.addEffectsForElementSelectedInDevtools(s),this.rules.push(i),this.ruleEventSubscriptions.push({ruleId:i.id,subscriptions:[i.hasSomethingToDoChanged.listen((e=>{this.ruleHasSomethingToDoChanged.dispatch({ruleId:i.id,hasSomethingToDo:e})})),i.effectOnElementSelectedInDevtoolsChanged.listen((()=>{this.effectOnElementSelectedInDevtoolsChanged.dispatch({ruleId:i.id})})),i.editableChanged.listen((()=>{this.ruleEditableChanged.dispatch({ruleId:i.id})}))]}),i.automatic){var r=new R;this.automaticExecutions.push({ruleId:i.id,cancellationToken:r}),this.executeAutomatically(i,r).then((()=>this.stopAutomaticRuleExecution(i.id)))}}removeRuleInternal(e){var t=this.rules.findIndex((t=>t.id===e));if(-1===t)return!1;var[s]=this.rules.splice(t,1);return this.cancelRuleEventSubscriptions(e),this.stopAutomaticRuleExecution(e),!0}removeRule(e){return!!this.removeRuleInternal(e)&&(this.collectionUpdated.dispatch(),this.ruleRemoved.dispatch({ruleId:e}),!0)}getStateForDraftRule(){return this.draftRule?this.draftRule.getState():null}getStateForRule(e){const t=this.rules.find((t=>t.id===e));return t?t.getState():null}getStates(){const e=[];for(let t of this.rules)e.push(t.getState());return e}getNotification(){var e=this.rules.map((e=>e.getNotification()));return{rules:e,numberOfRules:e.length,numberOfRulesThatHaveSomethingToDo:e.filter((e=>e.hasSomethingToDo)).length,numberOfRulesThatHaveExecuted:e.filter((e=>e.hasExecuted)).length}}getEffectOnNode(e){const t=this.rules.map((t=>({ruleId:t.id,effect:t.getEffectOnNode(e)})));return this.draftRule&&t.push({effect:this.draftRule.getEffectOnNode(e)}),t}}class _{constructor(e){this.propertyName=e}getValue(e){return e.style.getPropertyValue(this.propertyName)}describeSelf(){return`style('${this.propertyName}')`}}class ${describeSelf(){return"rect"}getValue(e){return e.rect}}class V{styleProperty(e){return new _(e)}rect(){return new $}}class k{nodePassesFilter(e){return!1}}class U{getRightFilter(e){return new k}}class Y{constructor(e){this.threshold=e}valuePassesFilter(e){return!isNaN(e)&&parseFloat(e)>this.threshold}describeSelf(e){return`${e} > ${this.threshold}`}}class H extends k{constructor(e,t){super(),this.valueExtractor=e,this.valueMatcher=t}nodePassesFilter(e){const t=this.valueExtractor.getValue(e);return this.valueMatcher.valuePassesFilter(t)}debugNodePassesFilter(e){const t=this.valueExtractor.getValue(e),s=this.valueMatcher.valuePassesFilter(t);return{message:`${this.valueMatcher.describeSelf(this.valueExtractor.describeSelf())}${s?"":"[31m<-- not true[37m"}`,pass:s}}}class j extends U{constructor(e,t){super(),this.thisValueMatcherFactory=e,this.otherValueExtractor=t}getRightFilter(e){const t=this.thisValueMatcherFactory(e);return new H(this.otherValueExtractor,t)}}class B extends k{constructor(e,t){super(t),this.filters=e}nodePassesFilter(e){for(const t of this.filters)if(!t.nodePassesFilter(e))return!1;return!0}debugNodePassesFilter(e){for(let t of this.filters){const s=t.debugNodePassesFilter(e);if(!s.pass)return s}return{message:"",pass:!0}}}class z extends U{constructor(e,t){super(),this.one=e,this.other=t}getRightFilter(e){const t=this.one.getRightFilter(e),s=this.other.getRightFilter(e);return new B([t,s])}}class W{constructor(e){this.minX=e.x,this.maxX=e.x+e.width,this.minY=e.y,this.maxY=e.y+e.height}valuePassesFilter(e){return e.x<=this.maxX&&e.x+e.width>=this.minX&&e.y<=this.maxY&&e.y+e.height>=this.minY}describeSelf(e){return`intersects(${e})`}}class G{constructor(e){this.nodeContext=e,this.parents=void 0}getParents(){if(!this.parents){this.parents=[];let e=this.nodeContext;for(;e=e.getParent();)this.parents.push(e)}return this.parents}valuePassesFilter(e){return e===this.nodeContext||this.getParents().some((t=>t===e))}}class J{getValue(e){return e}}class Q{constructor(e){this.otherValueExtractor=e}greaterThan(e){const t=new j((t=>new Y(e.getValue(t))),this.otherValueExtractor);return new X(t)}intersects(e){const t=new j((t=>new W(e.getValue(t))),this.otherValueExtractor);return new X(t)}}class X{constructor(e){this.current=e||new U}styleProperty(e){const t=new _(e);return new Q(t)}rect(){const e=new $;return new Q(e)}build(){return this.current}and(e){const t=e(new X).build();return new X(new z(this.current,t))}isSameAsOrParentOf(e){const t=new j((e=>new G(e)),new J);return new X(t)}}class Z{valuePassesFilter(e){return""!==e&&!isNaN(e)}describeSelf(e){return`${e} is a number`}}class K extends k{constructor(e,t){super(t),this.filters=e}nodePassesFilter(e){for(const t of this.filters)if(t.nodePassesFilter(e))return!0;return!1}debugNodePassesFilter(e){const t=this.filters.map((t=>t.debugNodePassesFilter(e)));return t.some((e=>e.pass))?{message:"",pass:!0}:{message:t.map((e=>`${e.message} [31m<-- is not true[37m`)).join(" | "),pass:!1}}}class ee{constructor(e){this.filterValue=e}valuePassesFilter(e){return e===this.filterValue}describeSelf(e){return`${e} = ${this.filterValue}`}}class te{constructor(e){this.intValue=e}valuePassesFilter(e){return parseInt(e)===this.intValue}describeSelf(e){return`${e} is integer`}}class se extends k{constructor(e,t){super(t),this.filter=e}nodePassesFilter(e){return!this.filter.nodePassesFilter(e)}debugNodePassesFilter(e){const t=this.filter.debugNodePassesFilter(e);return t.pass?{message:`!(${t.message} [31m<-- is true[37m)`,pass:!1}:{message:"",pass:!0}}}class ne extends k{constructor(e){super(),this.filter=e}nodePassesFilter(e){if(!this.filter.nodePassesFilter(e))return!1;const t=e.getParent();return!t||this.nodePassesFilter(t)}debugNodePassesFilter(e){const t=this.filter.debugNodePassesFilter(e);if(!t.pass)return{message:`selfAndAllParents(${t.message})`,pass:!1};let s=e;for(;s=s.getParent();)if(!this.filter.debugNodePassesFilter(s))return{message:`selfAndAllParents(${t.message} [31m(for some parent)[37m)`,pass:!1};return{message:"selfAndAllParents(...)",pass:!0}}}class ie extends k{constructor(e,t){super(t),this.filter=e,this.allParentsFilter=new ne(new se(e))}nodePassesFilter(e){if(!this.filter.nodePassesFilter(e))return!1;const t=e.getParent();return!t||this.allParentsFilter.nodePassesFilter(t)}debugNodePassesFilter(e){const t=this.filter.debugNodePassesFilter(e);if(!t.pass)return{message:`selfAndNoParent(${t.message})`,pass:!1};let s=e;for(;s=s.getParent();)if(this.filter.debugNodePassesFilter(s).pass)return{message:"selfAndNoParent(... [31m(true for some parent)[37m)",pass:!1};return{message:"selfAndNoParent(...)",pass:!0}}}class re{valuePassesFilter(e){return e.x<=innerWidth&&e.x+e.width>=0&&e.y<=innerHeight&&e.y+e.height>=0}describeSelf(e){return`isInViewport(${e})`}}class oe{valuePassesFilter(e){return e.x<innerWidth&&e.x+e.width>0&&e.y<innerHeight&&e.y+e.height>0&&(e.x+e.width>innerWidth||e.x<0||e.y+e.height>innerHeight||e.y<0)}describeSelf(e){return`exceedsViewport(${e})`}}class ae extends k{constructor(e){super(),this.nodeNames=e.map((e=>e.toLowerCase()))}nodePassesFilter(e){const t=e.nodeName.toLowerCase();return this.nodeNames.some((e=>e===t))}}class ue extends k{nodePassesFilter(e){for(let t of e.node.childNodes)if(t.nodeType===Node.TEXT_NODE&&/\S[\.,?;]\s+\S/.test(t.nodeValue))return!0;return!1}}class le{constructor(e){this.valueExtractor=e}isNumber(){return new ce(new H(this.valueExtractor,new Z))}equals(e){return new ce(new H(this.valueExtractor,new ee(e)))}equalsInt(e){return new ce(new H(this.valueExtractor,new te(e)))}isInViewport(){return new ce(new H(this.valueExtractor,new re))}exceedsViewport(){return new ce(new H(this.valueExtractor,new oe))}}class ce{constructor(e){this.current=e||new k}build(){return this.current}styleProperty(e){const t=new _(e);return new le(t)}hasText(){return new ce(new ue)}nodeNameIsOneOf(e){return new ce(new ae(e))}rect(){const e=new $;return new le(e)}and(e){const t=e(new ce).build();return new ce(new B([this.current,t]))}or(e){const t=e(new ce).build();return new ce(new K([this.current,t]))}not(){return new ce(new se(this.current))}selfAndAllParents(){return new ce(new ne(this.current))}selfAndNoParent(){return new ce(new ie(this.current))}}class de{allowsRightPresent(){return!0}}class he extends de{allowsRightPresent(){return!1}}class ge{constructor(e){this.current=e||new de}build(){return this.current}absent(){return new ge(new he)}}class fe{constructor(e,t){this.joinFilter=e,this.resultFilter=t||new de}where(e){const t=e(new ge).build();return new fe(this.joinFilter,t)}debugPresenceOfElementLeft(e,t,s,n,i){const r=e.debugPresenceOfElement(n,i);if(!r.present)return{message:`${r.message}.${s}(...)`,present:!1};const o=this.joinFilter.getRightFilter(r.present);if(!this.resultFilter.allowsRightPresent())for(let e of t.executeInternal(i))if(o.nodePassesFilter(e))return{message:`${r.message}.${s}(...[31m<-- something was found on the right side[37m)`,present:!1};return{message:"",present:r.present}}*execute(e,t,s){const n=[...t.executeInternal(s)],i=this.resultFilter.allowsRightPresent();for(let t of e.executeInternal(s)){const e=this.joinFilter.getRightFilter(t);i||n.some((t=>e.nodePassesFilter(t)))||(yield{left:t})}}}class me{constructor(e){this.joinFilter=e}debugPresenceOfElementLeft(e,t,s,n,i){}*execute(e,t,s){const n=[...t.executeInternal(s)];for(let t of e.executeInternal(s)){const e=this.joinFilter.getRightFilter(t);for(let s of n)e.nodePassesFilter(s)&&(yield{left:t,right:s})}}}class pe{executeInternal(e){return e}*execute(e){for(let t of this.executeInternal(e))yield t.node}debugPresenceOfElement(e,t){return t.debugPresenceOfElement(e)}static create(e){return e(new Te).build()}}class ve extends pe{constructor(e){super(),this.previous=e}*executeInternal(e){const t=[];for(let s of this.previous.executeInternal(e))t.includes(s)||(t.push(s),yield s)}}class Re extends pe{constructor(e,t){super(),this.previous=e,this.nodeFilter=t}debugPresenceOfElement(e,t){const s=this.previous.debugPresenceOfElement(e,t);if(!s.present)return{message:`${s.message}.where(...)`,present:!1};const n=this.nodeFilter.debugNodePassesFilter(s.present);return n.pass?{message:"where(...)",present:s.present}:{message:`where(x => ${n.message})`,present:!1}}*executeInternal(e){for(let t of this.previous.executeInternal(e))this.nodeFilter.nodePassesFilter(t)&&(yield t)}}class ye{constructor(e,t,s,n){this.ones=e,this.others=t,this.combinator=s,this.methodName=n}debugPresenceOfElementLeft(e,t){return this.combinator.debugPresenceOfElementLeft(this.ones,this.others,this.methodName,e,t)}debugPresenceOfElementRight(e,t){return this.combinator.debugPresenceOfElementRight(this.ones,this.others,this.methodName,e,t)}execute(e){return this.combinator.execute(this.ones,this.others,e)}}class Se extends pe{constructor(e){super(),this.joiningListQuery=e}debugPresenceOfElement(e,t){const s=this.joiningListQuery.debugPresenceOfElementRight(e,t);return{message:`${s.message}.selectRight()`,present:s.present}}*executeInternal(e){for(let t of this.joiningListQuery.execute(e))yield t.right}}class Ee extends pe{constructor(e){super(),this.joiningListQuery=e}debugPresenceOfElement(e,t){const s=this.joiningListQuery.debugPresenceOfElementLeft(e,t);return{message:`${s.message}.selectLeft()`,present:s.present}}*executeInternal(e){for(let t of this.joiningListQuery.execute(e))yield t.left}}class we{constructor(e){this.filterContexts=e}getForNode(e){return this.filterContexts.find((t=>t.node===e))}debugPresenceOfElement(e){return{message:"",present:this.getForNode(e)}}[Symbol.iterator](){return this.filterContexts[Symbol.iterator]()}static create(){const e=[],t=new we(e);for(let s of document.querySelectorAll("*")){const n=new be(s,t);e.push(n)}return t}}class be{constructor(e,t){this.list=null,this.node=e,this._style=null,this._rect=null,this._parent=null,this.repository=t}get rect(){return null===this._rect&&(this._rect=this.node.getBoundingClientRect()),this._rect}get nodeName(){return this.node.nodeName}get style(){return null===this._style&&(this._style=getComputedStyle(this.node)),this._style}getParent(){return null===this._parent&&this.node.parentNode&&this.node.parentNode!==document&&(this._parent=this.repository.getForNode(this.node.parentNode)),this._parent}static getAll(){return we.create()}}class Ie{constructor(e,t,s,n){this.ones=e,this.others=t,this.combinator=s,this.methodName=n}build(){return new ye(this.ones,this.others,this.combinator,this.methodName)}where(e){const t=this.combinator.where(e);return new Ie(this.ones,this.others,t,this.methodName)}selectLeft(){return new Te(new Ee(this.build()))}selectRight(){return new Te(new Se(this.build()))}}class Te{constructor(e){this.current=e||new pe}build(){return this.current}where(e){const t=e(new ce).build();return new Te(new Re(this.current,t))}distinct(){return new Te(new ve(this.current))}leftJoinSelf(e){const t=new V;let s=new X;s=e(t,s);const n=s.build(),i=new fe(n);return new Ie(this.current,this.current,i,"leftJoinSelf")}join(e,t){const s=pe.create(e),n=new V;let i=new X;i=t(n,i);const r=i.build();return new Ie(this.current,s,new me(r),"join")}}class Ae{constructor(){this.query=pe.create((e=>e.where((e=>e.styleProperty("z-index").isNumber().and((e=>e.rect().isInViewport())).and((e=>e.styleProperty("position").equals("relative").not())).and((e=>e.styleProperty("opacity").equals("0").or((e=>e.styleProperty("visibility").equals("hidden"))).or((e=>e.styleProperty("display").equals("none"))).or((e=>e.styleProperty("width").equalsInt(0).and((e=>e.styleProperty("height").equalsInt(0))))).not().selfAndAllParents())).selfAndNoParent())).leftJoinSelf(((e,t)=>t.styleProperty("z-index").greaterThan(e.styleProperty("z-index")).and((t=>t.rect().intersects(e.rect()))))).where((e=>e.absent())).selectLeft()))}debugSuggestionForElement(e,t){const s=this.query.debugPresenceOfElement(e,t);s.pass?console.log("BlockedPageSuggestionProvider says that this element blocks the page"):(console.log("BlockedPageSuggestionProvider says that this element does not block the page:"),console.log(s.message))}createSuggestions(e,t){for(const s of this.query.execute(t))e.addNodeActionSuggestion(s,i.getDeleteActionDefinition(),"delete")}}class xe{constructor(e){this.classRepository=e}addSuggestionsToRemoveStylePropertiesFromNodes(e,t,s,n){const r=[];for(let o of e){for(let e of t)""!==o.style.getPropertyValue(e)&&s.addNodeActionSuggestion(o,i.getRemoveStylePropertyActionDefinition(e),n);for(let e of this.classRepository.getClassesThatLeadToPropertiesOnElement(o,t))r.includes(e)||r.push(e)}for(let e of r)s.addSelectActionSuggestion(`.${e}`,i.getRemoveClassActionDefinition(e),n)}}class Ne extends xe{constructor(e){super(e),this.query=pe.create((e=>e.where((e=>e.rect().exceedsViewport())).join((e=>e.where((e=>e.styleProperty("overflow-x").equals("hidden").or((e=>e.styleProperty("overflow-y").equals("hidden")))))),((e,t)=>t.isSameAsOrParentOf(e))).selectRight().distinct()))}debugSuggestionForElement(e,t){const s=this.query.debugPresenceOfElement(e,t);s.pass?console.log("UnscrollablePageSuggestionProvider says that this element prevents scrolling"):(console.log("UnscrollablePageSuggestionProvider says that this element does not prevent scolling:"),console.log(s.message))}createSuggestions(e,t){this.addSuggestionsToRemoveStylePropertiesFromNodes(this.query.execute(t),["overflow-x","overflow-y"],e,"show overflow")}}class Me extends class{constructor(e,t){this.id=void 0,this.actionDefinition=e,this.description=t,this.hasExecuted=!1,this.undoing=void 0,this.removed=!1}isAchievedByRules(e){return!1}performsActionForNode(e,t){return!1}highlight(e){}setAsRemoved(){this.removed=!0}execute(e){const t=q(this.actionDefinition,e);this.undoing=t.execute(),this.hasExecuted=!0}undo(){this.undoing&&(this.undoing.execute(),this.undoing=void 0,this.hasExecuted=!1)}getSummary(){return{id:this.id,actionDefinition:this.actionDefinition,hasExecuted:this.hasExecuted,description:this.description}}}{constructor(e,t,s,n){super(s,n),this.selectorText=e,this.nodeActionDefinition=t}equals(e){return!!e&&e.selectorText===this.selectorText&&i.nodeActionsAreEqual(this.nodeActionDefinition,e.nodeActionDefinition)}isAchievedByRules(e){for(let t of document.querySelectorAll(this.selectorText))if(!this.isAchievedByRulesForNode(t,e))return!1;return!0}isAchievedByRulesForNode(e,t){const s=t.getEffectOnNode(e);for(const e of s)for(const t of e.effect)if(i.actionIsAchievedByOther(this.nodeActionDefinition,t.actionDefinition))return!0;return!1}performsActionForNode(e,t){if(!e)return!1;var s=!1;try{s=e.matches(this.selectorText)}catch(t){return console.log("problem executing node.matches",e,this.selectorText),!1}return!!s&&i.actionIsAchievedByOther(t,this.nodeActionDefinition)}static create(e,t,s){const n=i.getSelectActionDefinition(e,t);return new Me(e,t,n,s)}}class Pe extends Me{constructor(e,t,s,n,i){super(t,s,n,i),this.node=e}highlight(e){this.hasExecuted||e.startIndicatingElement(this.node)}static create(e,t,s){const n=I.forElement(e),r=i.getSelectActionDefinition(n.text,t);return new Pe(e,n.text,t,r,s)}}class Fe{constructor(e,t,s,n){this.ruleCollection=e,this.elementIndicator=t,this.documentMutationsProvider=s,this.latestSuggestionId=-1,this.suggestions=[],this.suggestionProviders=n,this.loaded=!1}clear(){this.suggestions=[]}removeSuggestion(e){const t=this.suggestions.indexOf(e);t>-1&&this.suggestions.splice(t,1)}addSelectActionSuggestion(e,t,s){const n=Me.create(e,t,s);if(!n.isAchievedByRules(this.ruleCollection)){for(const e of this.suggestions)if(e instanceof Me&&n.equals(e))return;var i=++this.latestSuggestionId;n.id=i,this.suggestions.push(n)}}addNodeActionSuggestion(e,t,s){const n=Pe.create(e,t,s);if(!n.isAchievedByRules(this.ruleCollection)){for(const s of this.suggestions)if(s.performsActionForNode(e,t))return;var i=++this.latestSuggestionId;n.id=i,this.suggestions.push(n)}}getAndRemoveSuggestionById(e){const t=this.suggestions.findIndex((t=>t.id===e));if(-1===t)return null;const s=this.suggestions[t];return this.suggestions.splice(t,1),s.getSummary()}ensureLoaded(){this.loaded||(this.createSuggestions(),this.loaded=!0)}reload(){this.createSuggestions()}createSuggestions(){this.stopHighlightingSuggestion();for(let e of this.suggestions.filter((e=>!e.hasExecuted)))this.removeSuggestion(e);const e=be.getAll();for(const t of this.suggestionProviders)t.createSuggestions(this,e)}debugSuggestionsForElement(e){const t=be.getAll();for(const s of this.suggestionProviders)s.debugSuggestionForElement(e,t)}getSuggestions(){return this.suggestions.filter((e=>!e.removed)).map((e=>e.getSummary()))}undoSuggestion(e){const t=this.suggestions.find((t=>t.id===e));t&&t.undo()}executeSuggestion(e){const t=this.suggestions.find((t=>t.id===e));t&&(this.elementIndicator.stopIndicatingElement(),t.execute(this.documentMutationsProvider))}markSuggestionAsRemoved(e){const t=this.suggestions.find((t=>t.id===e));t&&t.setAsRemoved()}startHighlightingSuggestion(e){const t=this.suggestions.find((t=>t.id===e));t.hasExecuted||t.highlight(this.elementIndicator)}stopHighlightingSuggestion(){this.elementIndicator.stopIndicatingElement()}}class Ce{constructor(){const e=document.createElement("div");e.setAttribute("class","macros-element-indicator"),this.indicator=e,this.elementBeingIndicated=void 0}startIndicatingElement(e){console.log("indicating element",e);const t=getComputedStyle(e),s=e.getBoundingClientRect(),n=t.getPropertyValue("z-index"),i=isNaN(n)?0:parseInt(n);this.indicator.style.zIndex=`${i+1}`,this.indicator.style.width=`${Math.max(s.width,1)}px`,this.indicator.style.height=`${Math.max(s.height,1)}px`,this.indicator.style.left=`${s.left}px`,this.indicator.style.top=`${s.top}px`,document.body.appendChild(this.indicator),this.elementBeingIndicated=e}stopIndicatingElement(e){e&&this.elementBeingIndicated!==e||null!==this.indicator.parentElement&&this.indicator.parentElement.removeChild(this.indicator)}}class De{*getApplicableCssStyleRules(e,t){for(let s of document.styleSheets)try{for(let n of s.cssRules)n instanceof CSSStyleRule&&e.matches(n.selectorText)&&t.some((e=>""!==n.style.getPropertyValue(e)))&&(yield n)}catch(e){}}*getClassNamesFromSelectorText(e){const t=/\.((?:-?[_a-zA-Z])[-_a-zA-Z0-9]*)/g;let s;for(;null!==(s=t.exec(e));)yield s[1]}*getClassesThatLeadToPropertiesOnElement(e,t){for(let s of this.getApplicableCssStyleRules(e,t))for(let e of this.getClassNamesFromSelectorText(s.selectorText))yield e}}class qe extends xe{constructor(e){super(e),this.query=pe.create((e=>e.where((e=>e.hasText().and((e=>e.nodeNameIsOneOf(["script","style"]).not())))).join((e=>e.where((e=>e.styleProperty("display").equals("none").and((e=>e.nodeNameIsOneOf(["script","head","title","style"]).not())).selfAndNoParent()))),((e,t)=>t.isSameAsOrParentOf(e))).selectRight().distinct()))}debugSuggestionForElement(e,t){const s=this.query.debugPresenceOfElement(e,t);s.pass?console.log("HiddenTextSuggestionProvider says that this element hides text"):(console.log("HiddenTextSuggestionProvider says that this element does not hide text:"),console.log(s.message))}createSuggestions(e,t){this.addSuggestionsToRemoveStylePropertiesFromNodes(this.query.execute(t),["display"],e,"display text")}}class Oe extends a{constructor(e){super(),this.attributeNames=e,this.observer=new MutationObserver((()=>this.notifyListeners())),this.observing=!1,this.listeners=[]}notifyListeners(){for(var e of this.listeners.slice())e()}removeListener(e){var t=this.listeners.indexOf(e);-1!==t&&(this.listeners.splice(t,1),this.listeners.length>0||(this.observer.disconnect(),this.observing=!1))}addListener(e){if(this.listeners.push(e),!this.observing){const e={childList:!0,subtree:!0};this.attributeNames&&this.attributeNames.length>0&&(e.attributeFilter=this.attributeNames),this.observer.observe(document,e),this.observing=!0}}}var Le=new class{getMutations(e){return new Oe(e)}};function _e(e,t,s){return`${e}:${t}:${s}`}function $e(e,t){return`${e}:${t}`}class Ve{constructor(e,t,s){this.id=_e(e,t,s),this.historyId=$e(e,t),this.url=s,this.tabId=e,this.frameId=t}focus(){chrome.tabs.update(this.tabId,{active:!0})}}const ke=new y("getCurrentNavigation");function Ue(e){return e.createChannel("navigationReplaced")}class Ye{constructor(e,t,s,n){this.getCurrentNavigationMessageTarget=e.ofType(ke),this.navigationReplacedMessage=t,this.navigationEventProvider=s,this.tabCollection=n}static createForBackground(e,t,s,n,i){const r=Ue(e);return s.navigationReplaced.listen((({navigationHistoryId:e,newNavigationId:t})=>{r.target.sendMessage({navigationHistoryId:e,newNavigationId:t})})),t.filter(((e,t)=>!!t.tab&&t.tab.id>0&&ke.filterMessage(e))).listen(((e,t,s)=>{s({id:_e(t.tab.id,t.frameId,t.url),historyId:$e(t.tab.id,t.frameId),tabId:t.tab.id})})),new Ye(n,r,s,i)}static create(e,t,s,n){const i=Ue(e);return new Ye(t,i,s,n)}getCurrent(){return this.getCurrentNavigationMessageTarget.sendMessageAsync({})}openTab(e){this.tabCollection.openTab(e)}async navigationExists(e){const t=await this.tabCollection.getAllTabs();for(let s of t)if(_e(s.id,0,s.url)===e)return!0;return await new Promise((async s=>{let n=!1;await Promise.all(t.map((async t=>{const i=await this.tabCollection.getAllFramesInTab(t.id);if(!n&&i)for(let r of i)if(_e(t.id,r.frameId,r.url)===e){n=!0,s(!0);break}}))),n||s(!1)}))}async getNavigationsForTabId(e){const t=await this.tabCollection.getAllFramesInTab(e),s=[],n={};for(let i of t){if(!/^https?:\/\//.test(i.url))continue;let t=new URL(i.url).hostname;void 0!==n[t]?t=`${t} (${++n[t].count})`:n[t]={count:1},s.push({top:0===i.frameId,frameId:i.frameId,url:i.url,id:_e(e,i.frameId,i.url),name:t})}return s}async getNavigationsForPopup(){const e=await this.tabCollection.getCurrentlyActiveTab();return await this.getNavigationsForTabId(e.id)}async getNavigation(e){const t=await this.tabCollection.getAllTabs();for(let s of t)if(_e(s.id,0,s.url)===e)return new Ve(s.id,0,s.url);return await new Promise((async s=>{let n=!1;await Promise.all(t.map((async t=>{const i=await this.tabCollection.getAllFramesInTab(t.id);if(!n&&i)for(let r of i)if(_e(t.id,r.frameId,r.url)===e){n=!0,s(new Ve(t.id,r.frameId,r.url));break}}))),n||s(null)}))}getPopupTabId(){return this.tabCollection.getPopupTabId()}onReplaced(e,t){return this.navigationReplacedMessage.source.onMessage(e,t)}onDisappeared(e,t){return this.navigationEventProvider.navigationDisappeared.listen(e,t)}onCreated(e,t){return this.navigationEventProvider.navigationCreated.listen(e,t)}whenDisappeared(e){return this.navigationEventProvider.navigationDisappeared.mapAsync((async()=>[await this.navigationExists(e)])).filter((e=>!e)).next()}}var He=new class extends a{addListener(e){chrome.tabs.onRemoved.addListener(e)}removeListener(e){chrome.tabs.onRemoved.removeListener(e)}},je=new class extends a{addListener(e){chrome.webNavigation.onCommitted.addListener(e)}removeListener(e){chrome.webNavigation.onCommitted.removeListener(e)}},Be=new class extends a{addListener(e){chrome.webNavigation.onHistoryStateUpdated.addListener(e)}removeListener(e){chrome.webNavigation.onHistoryStateUpdated.removeListener(e)}},ze=new class extends a{addListener(e){chrome.webNavigation.onReferenceFragmentUpdated.addListener(e)}removeListener(e){chrome.webNavigation.onReferenceFragmentUpdated.removeListener(e)}},We=new c([Be,ze]);class Ge extends E{constructor(e,t){super(),this.tabMessagesTargets=e,this.runtimeMessagesTarget=t,this.updated=new p}prune(e){this.tabMessagesTargets=this.tabMessagesTargets.filter((t=>-1!==e.indexOf(t.tabId)))}getTargets(){return[this.runtimeMessagesTarget].concat(this.tabMessagesTargets)}sendMessageAsync(e){return new Promise((t=>{var s=this.getTargets();for(let n of s)n.sendMessageAsync(e).then((e=>t(e)),(e=>{}))}))}sendMessage(e){for(var t of this.getTargets())t.sendMessage(e)}serialize(){return this.tabMessagesTargets.map((e=>e.tabId))}addTarget(e){this.tabMessagesTargets.some((t=>t.tabId===e.tabId))||(this.tabMessagesTargets.push(e),this.updated.dispatch())}static create(e,t,s){const n=e.map((e=>s.createTarget(e)));return new Ge(n,t)}}class Je{constructor(e,t,s,n){this.storage=e,this.tabCollection=t,this.runtimeMessagesTarget=s,this.tabMessagesTargetFactory=n,this.loaded=!1,this.subscriptions={}}async pruneSubscriptions(){this.ensureLoaded();const e=(await this.tabCollection.getAllTabs()).map((e=>e.id));for(let t of Object.getOwnPropertyNames(this.subscriptions)){const s=this.subscriptions[t];s&&s.prune(e)}this.save()}async ensureLoaded(){if(this.loaded)return;const e=await this.storage.getItem("crossBoundarySubscriptions");if(e)for(let t of Object.getOwnPropertyNames(e)){const s=Ge.create(e[t],this.runtimeMessagesTarget,this.tabMessagesTargetFactory);s.updated.listen((()=>this.save())),this.subscriptions[t]=s}this.loaded=!0}async save(){await this.storage.setItem("crossBoundarySubscriptions",this.serialize())}serialize(){const e={};for(let t of Object.getOwnPropertyNames(this.subscriptions)){const s=this.subscriptions[t];if(!s)continue;const n=s.serialize();e[t]=n}return e}async addTargetForType(e,t){await this.ensureLoaded();let s=this.subscriptions[e];s||(s=new Ge([],this.runtimeMessagesTarget),s.updated.listen((()=>this.save())),this.subscriptions[e]=s),s.addTarget(t)}async getTargetForType(e){return await this.ensureLoaded(),this.subscriptions[e]||new Ge([],this.runtimeMessagesTarget)}}class Qe{constructor(e,t){this.target=e,this.source=t}}var Xe=new y("crossBoundarySubscription"),Ze=new y("requestTarget");class Ke extends E{constructor(e,t){super(),this.type=e,this.messageType=new y(e),this.subscriptionCollection=t}async getTarget(){return(await this.subscriptionCollection.getTargetForType(this.type)).ofType(this.messageType)}sendMessage(e){this.getTarget().then((t=>t.sendMessage(e)))}async sendMessageAsync(e){return(await this.getTarget()).sendMessageAsync(e)}}class et extends E{constructor(e,t,s,n){super(),this.targetRequestTarget=t,this.type=e,this.messageType=new y(e),this.runtimeMessagesTarget=s,this.tabMessagesTargetFactory=n}async getTarget(){const e=await this.targetRequestTarget.sendMessageAsync({type:this.type});return Ge.create(e,this.runtimeMessagesTarget,this.tabMessagesTargetFactory).ofType(this.messageType)}sendMessage(e){this.getTarget().then((t=>t.sendMessage(e)))}async sendMessageAsync(e){var t=await this.getTarget();return await t.sendMessageAsync(e)}}class tt extends S{constructor(e,t,s){super();const n=new y(e);this.source=s.ofType(n),this.messageFromNavigationSource=t.navigationMessages.filter((e=>n.filterMessage(e))).map(((e,t,s)=>[n.unpackMessage(e),t,s]))}onMessage(e,t){return this.source.onMessage(e,t)}onMessageFromNavigation(e,t){return this.messageFromNavigationSource.listen(e,t)}}class st extends S{constructor(e,t,s,n){super();const i=new y(e);this.type=e,this.source=s.ofType(i),this.messageFromNavigationSource=t.navigationMessages.filter((e=>i.filterMessage(e))).map(((e,t,s)=>[i.unpackMessage(e),t,s])),this.subscriptionMessageTarget=n}onMessage(e,t){return this.subscriptionMessageTarget.sendMessage({messageType:this.type}),this.source.onMessage(e,t)}onMessageFromNavigation(e,t){return this.messageFromNavigationSource.listen(e,t)}}class nt{constructor(e,t,s){this.subscriptionCollection=e,this.navigationEventProvider=t,this.runtimeMessagesSource=s}createChannel(e){const t=new Ke(e,this.subscriptionCollection),s=new tt(e,this.navigationEventProvider,this.runtimeMessagesSource);return new Qe(t,s)}}class it{constructor(e,t,s,n,i,r){this.targetRequestTarget=e,this.runtimeMessagesTarget=t,this.runtimeMessagesSource=s,this.navigationEventProvider=n,this.subscriptionMessageTarget=i,this.tabMessagesTargetFactory=r}createChannel(e){const t=new et(e,this.targetRequestTarget,this.runtimeMessagesTarget,this.tabMessagesTargetFactory),s=new st(e,this.navigationEventProvider,this.runtimeMessagesSource,this.subscriptionMessageTarget);return new Qe(t,s)}}class rt extends E{constructor(e){super(),this.tabId=e}sendMessage(e){chrome.tabs.sendMessage(this.tabId,e)}sendMessageAsync(e){return new Promise(((t,s)=>{chrome.tabs.sendMessage(this.tabId,e,(n=>{var i=chrome.runtime.lastError;i?s(`error when sending message to tab ${this.tabId}. Message: ${JSON.stringify(e)}. Error: ${i.message}`):t(n)}))}))}}const ot=new class{createTarget(e){return new rt(e)}},at=new class extends E{sendMessageAsync(e){return new Promise(((t,s)=>{chrome.runtime.sendMessage(void 0,e,(n=>{var i=chrome.runtime.lastError;i?s(`error when sending message. Message: ${JSON.stringify(e)}. Error: ${i.message}`):t(n)}))}))}sendMessage(e){chrome.runtime.sendMessage(void 0,e)}},ut=new class extends a{addListener(e){chrome.runtime.onMessage.addListener(e)}removeListener(e){chrome.runtime.onMessage.removeListener(e)}},lt=new class extends S{constructor(e){super(),this.source=e.map(((e,t,s)=>[e,s]))}onMessage(e,t){return this.source.listen(e,t)}}(ut),ct=new class{openTab(e){chrome.tabs.create({url:e})}getAllTabs(){return new Promise((e=>chrome.tabs.query({},e)))}getAllFramesInTab(e){return new Promise((t=>chrome.webNavigation.getAllFrames({tabId:e},t)))}getCurrentlyActiveTab(){return new Promise(((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(s=>{1===s.length?e(s[0]):t(new Error(`looked for the single active tab, but found ${s.length} tabs`))}))}))}getPopupTabId(){return new Promise(((e,t)=>{chrome.tabs.query({lastFocusedWindow:!0,active:!0},(s=>{1===s.length?e(s[0].id):t(new Error(`looked for the single active tab, but found ${s.length} tabs`))}))}))}tabExists(e){return new Promise((t=>{chrome.tabs.get(e,(e=>{var s=chrome.runtime.lastError;t(!!e&&!s)}))}))}},dt=new class{constructor(e,t,s,n){this.navigationCreated=s.map((({tabId:e,frameId:t,url:s})=>[new Ve(e,t,s)])),this.navigationMessages=e.filter(((e,t)=>!!t.tab&&t.tab.id>0)).map(((e,{frameId:t,tab:s,url:n},i)=>[e,new Ve(s.id,t,s.url),i])),this.navigationReplaced=n.map((({tabId:e,frameId:t,url:s})=>[{navigationHistoryId:$e(e,t),newNavigationId:_e(e,t,s)}])),this.navigationDisappeared=new c([s,t,n])}}(ut,He,je,We),ht=class{static createForBackground(e,t,s,n,i,r,o,a,u){const l=new Je(e,t,n,u);return s.filter(((e,t)=>Xe.filterMessage(e)&&!r.isExtension(t))).map(((e,t)=>[Xe.unpackMessage(e),u.createTarget(t.tab&&t.tab.id)])).listen((({messageType:e},t)=>{l.addTargetForType(e,t)})),o.listen((()=>l.pruneSubscriptions())),i.ofType(Ze).onMessage((({type:e},t)=>(l.getTargetForType(e).then((e=>t(e.serialize()))),!0))),new nt(l,a,i)}static create(e,t,s,n){const i=e.ofType(Ze),r=e.ofType(Xe);return new it(i,e,t,s,r,n)}}.create(at,lt,dt,ot),gt=Ye.create(ht,at,dt,ct),{onElementSelectedInDevtools:ft,debugSuggestionsForElement:mt,getElementSelectedInDevtools:pt}=function(e,t,s){var n,i,o,a,u=new De,l=[new Ae,new Ne(u),new qe(u)],c=new r(e,void 0,t),d=new L(c,s),h=new Fe(d,new Ce,s,l);function g(e){c.notifyRulesForNavigation({navigationId:i,url:a,tabId:o,rules:e.rules,numberOfRules:e.numberOfRules,numberOfRulesThatHaveSomethingToDo:e.numberOfRulesThatHaveSomethingToDo,numberOfRulesThatHaveExecuted:e.numberOfRulesThatHaveExecuted})}function f(e){const t=e instanceof HTMLElement?e:null;return n=t,d.addEffectsForElementSelectedInDevtools(t),t?{tabId:o,navigationId:i,selector:I.forElement(t),isHtmlElement:!0}:e?{tabId:o,navigationId:i,selector:null,isHtmlElement:!1}:null}function m(e){const t=d.getStateForRule(e);c.notifyRuleStateForNavigationChanged(i,t)}function p(){const e=d.getStateForDraftRule();c.notifyDraftRuleStateForNavigation(i,e)}return async function(){a=location.href;var t=await e.getCurrent(),r=t.historyId;i=t.id,o=t.tabId,console.log(`navigation id '${i}', navigation history id '${r}', tabId ${o}`),d.notifications.listen((e=>{console.log("something happened to the rule collection; sending notification"),g(e)})),d.ruleHasSomethingToDoChanged.listen((({ruleId:e,hasSomethingToDo:t})=>{m(e)})),d.ruleEditableChanged.listen((({ruleId:e})=>{m(e)})),d.ruleExecuted.listen((({ruleId:e})=>{m(e)})),d.draftRuleHasSomethingToDoChanged.listen((()=>{p()})),d.effectOnElementSelectedInDevtoolsChanged.listen((({ruleId:e})=>{m(e)})),d.effectOfDraftRuleOnElementSelectedInDevtoolsChanged.listen((()=>{p()})),d.ruleRemoved.listen((({ruleId:e})=>{c.notifyRuleStateForNavigationRemoved(i,e)})),d.ruleAdded.listen((({ruleId:e})=>{m(e)})),await d.refresh(a,i,n),c.onDraftRuleCreated((({navigationId:e,draftRule:t})=>{e===i&&(d.setDraftRuleForDefinition(t,n),p())})),c.onDraftRuleChanged((({navigationId:e,draftRule:t})=>{e===i&&(d.setDraftRuleForDefinition(t,n),p())})),c.onDraftRulesRemoved((e=>{e.some((e=>e===i))&&(d.setDraftRuleForDefinition(null),p())})),c.onRuleAdded((()=>d.refresh(a,i,n))),c.onRuleDeleted((({ruleId:e})=>d.removeRule(e))),c.onRuleUpdated((async({ruleId:e})=>{d.removeRule(e),await d.refresh(a,i,n),d.getStateForRule(e)||c.notifyRuleStateForNavigationRemoved(i,e)})),e.onReplaced((async({navigationHistoryId:e,newNavigationId:t})=>{e===r&&(t!==i?(console.log("navigation replaced. setting url, navigationId and rules again"),a=location.href,i=t,await d.refresh(a,i,n),g(d.getNotification())):console.log("the navigation was replaced with one that has the same id!"))})),c.onExecuteRuleRequest((({ruleId:e,navigationId:t},s)=>{t===i&&(console.log(`navigation '${i}' got request to execute rule:`,e),d.executeRule(e),s({}))})),c.onExecuteSuggestionRequest((({suggestionId:e,navigationId:t},s)=>{t===i&&(h.executeSuggestion(e),s({}))})),c.onUndoSuggestionRequest((({suggestionId:e,navigationId:t},s)=>{t===i&&(h.undoSuggestion(e),s({}))})),c.onGetSuggestionsRequest((({navigationId:e},t)=>{e===i&&(h.ensureLoaded(),t(h.getSuggestions()))})),c.onReloadSuggestionsRequest((({navigationId:e},t)=>{e===i&&(h.reload(),t(h.getSuggestions()))})),c.onMarkSuggestionAsRemoved((({suggestionId:e,navigationId:t},s)=>{t===i&&(h.markSuggestionAsRemoved(e),s({}))})),c.onExecuteActionRequest((({navigationId:e,action:t},n)=>{e===i&&(q(t,s).execute(),n({}))})),c.onNotifySuggestionIndicationStart((({navigationId:e,suggestionId:t})=>{e===i&&h.startHighlightingSuggestion(t)})),c.onNotifySuggestionIndicationEnd((({navigationId:e,suggestionId:t})=>{e===i&&h.stopHighlightingSuggestion()})),c.onGetAndRemoveSuggestionRequest((({suggestionId:e,navigationId:t},s)=>{t===i&&s(h.getAndRemoveSuggestionById(e))})),c.onGetRuleStatesForNavigation((({navigationId:e},t)=>{e===i&&t(d.getStates())})),c.onDraftRuleStateForNavigationRequest((({navigationId:e},t)=>{e===i&&t(d.getStateForDraftRule())})),c.onRequestToExecuteDraftRule((({navigationId:e},t)=>{e===i&&(d.executeDraftRule(),t({}),p())})),c.onEditedStatusChanged((({ruleId:e,otherNavigationId:t,edited:s})=>{void 0!==e&&(s?s&&t!==i&&d.setEditable(e,!1):d.setEditable(e,!0))}))}(),{onElementSelectedInDevtools:function(e){const t=f(e);t&&c.notifySelectedElementInDevtools(t)},debugSuggestionsForElement:function(e){h.debugSuggestionsForElement(e)},getElementSelectedInDevtools:f}}(gt,ht,Le)}},t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}return s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(850)})()}));